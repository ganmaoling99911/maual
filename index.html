<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE MANUAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Keyframes for colored orbs (base background) */
        @keyframes float { 0%, 100% { transform: translate(0px, 0px); } 50% { transform: translate(30px, -50px); } }
        @keyframes float-2 { 0%, 100% { transform: translate(0px, 0px); } 50% { transform: translate(-40px, 40px); } }
        @keyframes float-3 { 0%, 100% { transform: translate(0px, 0px); } 50% { transform: translate(25px, 45px); } }
        @keyframes color-cycle-earth { 0% { background-color: #DCD5C8; } 33% { background-color: #8E8371; } 66% { background-color: #463f3a; } 100% { background-color: #DCD5C8; } }
        @keyframes color-cycle-sky { 0% { background-color: #87CEEB; } 50% { background-color: #a2d2ff; } 100% { background-color: #87CEEB; } }
        
        /* Keyframes for image orbs movement */
        @keyframes orb-fusion-1 { 0% { transform: translate(0, 0) scale(0.9); } 25% { transform: translate(20vw, -15vh) scale(1.1); } 50% { transform: translate(-10vw, 10vh) scale(1); } 75% { transform: translate(15vw, 20vh) scale(1.2); } 100% { transform: translate(0, 0) scale(0.9); } }
        @keyframes orb-fusion-2 { 0% { transform: translate(0, 0) scale(1.1); } 25% { transform: translate(-25vw, 10vh) scale(0.9); } 50% { transform: translate(10vw, -5vh) scale(1.2); } 75% { transform: translate(-15vw, -15vh) scale(1); } 100% { transform: translate(0, 0) scale(1.1); } }
        @keyframes orb-fusion-3 { 0% { transform: translate(0, 0) scale(1); } 25% { transform: translate(10vw, 25vh) scale(1.2); } 50% { transform: translate(-20vw, -10vh) scale(0.9); } 75% { transform: translate(5vw, -20vh) scale(1.1); } 100% { transform: translate(0, 0) scale(1); } }
        
        /* Keyframe for "Holy Light" effect on checkbox */
        @keyframes holy-glow { 0% { box-shadow: 0 0 10px 2px rgba(255, 223, 100, 0.4); } 50% { box-shadow: 0 0 25px 8px rgba(255, 235, 150, 0.7); } 100% { box-shadow: 0 0 10px 2px rgba(255, 223, 100, 0.4); } }
        
        body {
            background-color: #000000; /* Black base for best blending */
            color: #f0f0f0;
            overflow-x: hidden;
            position: relative;
            font-family: 'Noto Sans SC', sans-serif;
        }

        /* --- Background Layers --- */
        .background-container.is-loading .sanctum-orb,
        .background-container.is-loading .image-orb {
            animation-play-state: paused;
        }
        .background-base-sky { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -3; overflow: hidden; filter: blur(120px); }
        .background-sanctum { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden; filter: blur(120px) saturate(1.2); }
        .background-image-orb-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        
        .sanctum-orb { position: absolute; border-radius: 50%; animation-iteration-count: infinite; animation-timing-function: ease-in-out; }
        .sky-orb { animation-duration: 30s; animation-name: float, color-cycle-sky; }
        .earth-orb { animation-duration: 25s; animation-name: float-2, color-cycle-earth; animation-delay: 0s, 7s; }
        .base-orb-1 { width: 80vw; height: 80vw; top: -30%; left: -30%; }
        .base-orb-2 { width: 70vw; height: 70vw; bottom: -40%; right: -30%; }
        .base-orb-3 { width: 60vw; height: 60vw; bottom: -10%; left: 5%; animation-name: float-3, color-cycle-sky; animation-delay: 0s, 14s; }

        .image-orb {
            position: absolute;
            background-size: cover;
            background-position: center;
            will-change: transform;
            animation-duration: 25s; 
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            mix-blend-mode: screen; 
            -webkit-mask-image: radial-gradient(circle, white 30%, transparent 65%);
            mask-image: radial-gradient(circle, white 30%, transparent 65%);
        }
        
        .image-orb .orb-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-size: cover;
            background-position: center;
            transition: opacity 2s ease-in-out;
            opacity: 1;
        }
        .image-orb .orb-bg.is-fading {
            opacity: 0;
        }

        .orb-1 { top: -20%; left: -20%; width: 70vw; height: 70vw; animation-name: orb-fusion-1; }
        .orb-2 { top: -10%; right: -25%; width: 80vw; height: 80vw; animation-name: orb-fusion-2; }
        .orb-3 { bottom: -25%; left: 10%; width: 75vw; height: 75vw; animation-name: orb-fusion-3; }

        /* --- UI Styling --- */
        .tab-active { color: #ffffff; background-color: rgba(255, 255, 255, 0.2); box-shadow: 0 0 15px rgba(255, 255, 255, 0.1), inset 0 0 5px rgba(255, 255, 255, 0.2); }
        .tab-inactive { color: #cccccc; }
        .tab-inactive:hover { color: #ffffff; background-color: rgba(255, 255, 255, 0.1); }
        .frosted-glass { background: rgba(26, 26, 26, 0.3); backdrop-filter: blur(24px) saturate(150%); -webkit-backdrop-filter: blur(24px) saturate(150%); border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 20px 40px rgba(0,0,0,0.3); color: #f0f0f0; }
        .modal-overlay { transition: opacity 0.3s ease; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(16px); }
        
        .task-item { position: relative; transition: all 0.4s ease; background-color: rgba(255, 255, 255, 0.05); overflow: hidden; border-radius: 0.75rem; }
        .task-item:hover { transform: scale(1.02); background-color: rgba(255, 255, 255, 0.1); }
        .task-item .task-circle { border-color: #888; transition: all 0.3s ease; }
        .task-item:hover .task-circle { border-color: #ffd700; }

        .task-checkbox:checked ~ .task-container .task-text { color: #aaa; }
        .task-checkbox:checked ~ .task-container { background-color: rgba(255, 215, 0, 0.1); box-shadow: 0 0 20px 3px rgba(255, 215, 0, 0.2); opacity: 0.85; }
        .task-checkbox:checked ~ .task-container .task-circle { 
            background-image: radial-gradient(circle, rgba(255, 235, 150, 0.9) 0%, rgba(255, 215, 0, 0.4) 50%, transparent 70%);
            border-color: rgba(255, 215, 0, 0.5);
            animation: holy-glow 2s infinite ease-in-out;
        }
        
        .module-button { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.2); color: #f0f0f0; }
        .module-button:hover { transform: translateY(-2px); background: rgba(255, 255, 255, 0.15); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); }
        .gradient-text { background: linear-gradient(45deg, #a2d2ff, #f0f0f0, #ffafcc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
        .journal-actions button { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.2s; }
        .journal-actions button:hover { background: rgba(255, 255, 255, 0.2); border-color: #a2d2ff; }

    </style>
</head>
<body class="min-h-screen">
    <div class="background-container is-loading">
        <div class="background-base-sky">
            <div class="sanctum-orb sky-orb base-orb-1"></div>
            <div class="sanctum-orb sky-orb base-orb-3" style="animation-delay: 0s, 10s;"></div>
        </div>
        <div class="background-sanctum">
            <div class="sanctum-orb earth-orb base-orb-2"></div>
        </div>
        <div id="image-orb-container" class="background-image-orb-container">
            <!-- JS will populate these -->
        </div>
    </div>

    <div class="container mx-auto max-w-5xl p-4 relative z-10">
        <header class="text-center my-10 md:my-16">
            <h1 class="text-5xl md:text-7xl font-bold gradient-text">THE MANUAL</h1>
        </header>

        <main class="frosted-glass rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8">
            <div class="mb-6">
                <nav class="flex flex-wrap gap-2 p-2 bg-black/20 rounded-xl" id="tabs-container">
                    <button data-tab="schedule" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-active transition-all duration-300 flex items-center justify-center">训练日程</button>
                    <button data-tab="journal" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300 flex items-center justify-center">日志</button>
                    <button data-tab="module1" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">松解</button>
                    <button data-tab="module2" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">呼吸</button>
                    <button data-tab="module3" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">地基</button>
                    <button data-tab="module4" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">控制</button>
                    <button data-tab="module5" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">拉伸</button>
                </nav>
            </div>

            <div id="tab-content-container">
                <div id="tab-schedule" class="tab-content">
                    <h3 class="text-xl font-bold text-white mb-4">今日训练任务</h3>
                    <div id="task-list" class="space-y-2"></div>
                </div>
                <div id="tab-journal" class="tab-content hidden">
                    <h3 class="text-xl font-bold text-white mb-4">训练日志</h3>
                    <div class="space-y-4">
                        <textarea id="journal-input" class="w-full h-40 bg-black/20 text-slate-200 p-4 rounded-lg border border-white/10 focus:border-cyan-400 focus:ring-cyan-400/50 focus:bg-black/30 transition-all duration-300" placeholder="记录今天的训练感受、身体反馈、任何值得注意的细节..."></textarea>
                        <button id="save-journal-entry" class="w-full module-button font-semibold py-3 px-5 rounded-lg text-white flex items-center justify-center gap-2 hover:bg-cyan-500/20 hover:border-cyan-400">保存日志</button>
                        <div id="journal-entries" class="space-y-4 max-h-[50vh] overflow-y-auto pr-2"></div>
                    </div>
                </div>
                <div id="tab-module1" class="tab-content hidden"></div>
                <div id="tab-module2" class="tab-content hidden"></div>
                <div id="tab-module3" class="tab-content hidden"></div>
                <div id="tab-module4" class="tab-content hidden"></div>
                <div id="tab-module5" class="tab-content hidden"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div id="modal-container" class="frosted-glass rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-8 opacity-0 transform scale-95 relative">
            <button id="modal-close-button" class="absolute top-4 right-4 text-gray-200 hover:text-white z-10">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div id="modal-content"></div>
        </div>
        
        <div id="journal-edit-modal" class="frosted-glass rounded-2xl w-full max-w-lg p-8 opacity-0 transform scale-95 hidden flex-col gap-4">
            <h3 class="text-xl font-bold text-white">修改日志</h3>
            <textarea id="journal-edit-input" class="w-full h-48 bg-black/20 text-slate-200 p-4 rounded-lg border border-white/10 focus:border-cyan-400 focus:ring-cyan-400/50 transition-all"></textarea>
            <div class="flex gap-4">
                <button id="journal-edit-cancel" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg">取消</button>
                <button id="journal-edit-save" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg bg-cyan-500/20 border-cyan-400 hover:bg-cyan-500/40">保存修改</button>
            </div>
        </div>

        <div id="delete-confirm-modal" class="frosted-glass rounded-2xl w-full max-w-sm p-8 opacity-0 transform scale-95 hidden flex-col gap-4 items-center">
             <h3 class="text-xl font-bold text-white">确认删除?</h3>
             <p class="text-slate-300 text-center">此操作无法撤销。</p>
             <div class="flex gap-4 w-full mt-4">
                <button id="delete-confirm-cancel" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg">取消</button>
                <button id="delete-confirm-button" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg bg-rose-500/20 border-rose-400 hover:bg-rose-500/40">删除</button>
            </div>
        </div>
    </div>

    <script>
        const exerciseData = {
            'foam-roll': { module: 1, title: '泡沫轴松解 - 关键抑制点', target: '暂时抑制和放松因长期久坐而过度紧张的关键肌肉：大腿前侧（股四头肌）与大腿外侧上方（阔筋膜张肌 - TFL）。', principle: '根据“交互抑制”原则，当一侧的肌肉过度紧张时，其功能相反的肌肉就会在神经层面受到抑制。股四头肌和TFL的过度紧张是抑制您臀肌的主要“元凶”。', benefit: '放松这两块肌肉，等于为“唤醒”臀部主力军创造绝佳的神经环境，从而改善训练质量，减少髋部和膝部的代偿与疼痛。', guide: `<ol><li class="mb-2"><strong>a. 松解股四头肌 (大腿前侧):</strong><ol class="list-decimal list-inside ml-4 text-gray-300"><li>将泡沫轴横放在垫上，以前臂支撑身体，呈俯卧姿势，将一侧大腿的前侧置于泡沫轴上。另一条腿屈膝向侧方打开，用以支撑和控制身体。</li><li>保持核心收紧，避免腰部塌陷。</li><li>用手臂和支撑腿的力量，驱动身体前后缓慢移动，让泡沫轴在您的大腿前侧（从髋关节下方到膝盖上方）来回滚动。</li><li>当找到一个特别酸痛的“激痛点”时，停止滚动，保持在该点上，进行3-4次深长而缓慢的呼吸（约15-20秒）。</li></ol></li><li><strong>b. 松解阔筋膜张肌 (TFL) / 大腿外侧最上方:</strong><ol class="list-decimal list-inside ml-4 text-gray-300"><li>身体侧卧，将泡沫轴置于您大腿外侧的<strong>最上方</strong>，大致在您裤子口袋的区域。</li><li>下方的手肘支撑在地上，上方的腿可以弯曲踩在身前或身后以帮助稳定和控制压力。</li><li>在这个**很小的区域内**（就在您髋部侧方骨头的正下方），进行小范围的、缓慢的前后或左右滚动。**不要向下滚动到大腿中段（髂胫束）**。</li><li>TFL通常非常敏感，请务必缓慢并配合深呼吸。</li></ol></li></ol>`, errorWhy: `<p><strong>1. 滚动速度过快：</strong>大脑想快速逃离不适感，但这无法给神经系统足够的时间去处理信号并让肌肉放松。</p><p><strong>2. 憋气：</strong>身体应对疼痛的本能反应，但这会激活交感神经，让肌肉更加紧张，适得其反。</p><p><strong>3. 核心松懈，腰部塌陷：</strong>注意力过于集中在局部，缺乏整体控制意识。</p>`, solution: `<p><strong>• 解决方案一 (针对速度与呼吸):</strong> 强制自己以“蜗牛”般的速度移动（想象每秒移动一厘米）。在找到的痛点上，进行**仪式化呼吸**：用鼻子深吸4秒，然后噘起嘴唇，用6-8秒的时间缓慢地、有控制地呼出气体，感受肌肉在呼气时“融化”在泡沫轴上。</p><p><strong>• 解决方案二 (针对核心):</strong> 在开始滚动前，先主动收紧腹部，想象有人要轻轻地戳你的肚子，你要有力量地“顶住”。在整个滚动过程中，都要保持这个“核心护甲”。</p><p><strong>• 您的个性化工具箱 (针对疼痛):</strong> <ul class="list-disc list-inside mt-1"><li><strong>降压：</strong>通过手臂和支撑腿更多地分担体重，来减轻泡沫轴的压力。</li><li><strong>“农村包围城市”策略：</strong>如果某个点过于疼痛，先在它周围不那么痛的区域进行放松，等周边肌肉放松后，再逐渐向核心痛点靠近。</li><li><strong>变滚动为按压：</strong>对于特别敏感的区域（如TFL），放弃滚动，改为静态按压。找到最痛的点，保持在上面，只做深呼吸，持续20-30秒，直到感觉紧张感明显缓解。</li></ul></p>` },
            'breathing': { module: 2, title: '90/90髋关节抬高伴球囊呼吸', target: '利用呼吸重置骨盆和胸廓的位置，建立一个力学上最优的“核心中立位”，为所有后续动作打下坚实基础。', principle: '不良姿势的核心是骨盆和胸廓的位置错误。此动作通过腘绳肌的发力将前倾的骨盆“卷”回中立位，通过呼气时腹肌的收缩将外翻的肋骨“拉回”原位，从而重建核心的稳定序列。', benefit: '直接解决体态问题的最底层根源，重建膈肌的正常功能，让您学会用核心而非颈肩来呼吸和稳定。一个中立、稳定的核心，是所有肢体正确运动的支撑平台。', guide: `<ol class="list-decimal list-inside text-gray-300"><li><strong>准备姿势：</strong>仰卧，双脚脚跟踩在墙上，使膝盖和髋关节都呈90度。双膝之间夹一个软球或枕头。</li><li><strong>启动：</strong>轻轻用脚后跟向下“拽”墙，您会感觉到大腿后侧（腘绳肌）有轻微的紧张感。利用这个力量，将您的尾骨（臀部）抬离地面一英寸，直到您的下背部平贴地面。</li><li><strong>呼吸序列：</strong><ol class="list-decimal list-inside ml-4"><li>用鼻子缓慢、安静地吸气，感觉气息充满您的胸腔和腹部。</li><li>用嘴巴缓慢、悠长地呼气，仿佛在吹一个气球。在呼气的最后，您应该感觉到腹部肌肉收紧，肋骨向内、向下沉。</li><li><strong>保持住！</strong>在不吸气的情况下，暂停2-3秒，维持腹肌收紧的感觉。</li><li>保持腹肌的收紧感，再次用鼻子吸气，重复整个过程。</li></ol></li><li><strong>要点：</strong>全程保持大腿后侧的轻微紧张感和下背部平贴地面。</li></ol>`, errorWhy: `<p><strong>1. 用腰发力抬臀：</strong>您的身体习惯于用已经过度活跃的竖脊肌去代偿无力的臀肌和腘绳肌，这是您旧有错误模式的直接体现。</p><p><strong>2. 过度抬高臀部：</strong>这是追求动作幅度而非质量的常见误区。这个动作的核心是实现“骨盆后倾”，而非“抬高臀部”。</p><p><strong>3. 吸气时失控：</strong>核心肌群的耐力不足，无法在膈肌下降产生腹压时，维持住肋骨和骨盆来之不易的中立位。</p>`, solution: `<p><strong>• 触觉反馈法 (针对腰部代偿):</strong> 将一只手放在下背部的空隙处，另一只手放在大腿后侧（腘绳肌）。正确的动作是，当下背部的手感觉到背部压实地面时，大腿后侧的手能摸到肌肉正在收紧。如果下背部变得更紧张，说明错了。</p><p><strong>• 幅度控制 (针对过度抬高):</strong> 忘掉“抬高”这个词，换成“**滚动**”。想象您的骨盆是一个碗，您只是想把碗边向您的脸的方向滚动一点点，让您的尾骨轻轻抬离地面一英寸。幅度不重要，骨盆后倾的感觉最重要。</p><p><strong>• 呼吸控制 (针对吸气失控):</strong> 在吸气时，将您的双手放在身体两侧的下肋廓上。您的目标是感觉到肋骨向两侧“推开”您的手，而不是向上或向前。吸气要慢、要轻柔，只吸到七八分满即可。</p><p><strong>• 您的个性化工具箱:</strong> <ul class="list-disc list-inside mt-1"><li><strong>腘绳肌激活困难？</strong>在开始前，先只做“用脚后跟向下拖拽墙壁”的动作，反复5-10次，直到您能清晰地感觉到大腿后侧的紧张感。</li><li><strong>球囊感觉太难？</strong>退阶练习。放弃球囊，只是噘起嘴唇，像通过一根很细的吸管一样，缓慢地、有阻力地呼气。把注意力完全放在感受腹部收紧和肋骨下沉上。</li></ul></p>` },
            'tripod-foot': { module: 3, title: '足部三点支撑与抓地训练', target: '学习有意识地建立一个稳定的足部“三脚架”支撑，并激活维持足弓的内在肌群。', principle: '我们先主动**设定**一个稳定的足部结构，然后再通过**等长收缩**（抓地）来强化它。这是一种更直接、更具象的神经连接训练。', benefit: '这是一个“地基工程”。稳定的“三脚架”足底能确保力量均匀上传，防止足踝向内塌陷（膝盖内扣的起始环节）。学会主动“抓地”等于给足弓装上“主动稳定系统”。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>舒适地坐在椅子上，双脚平放于地面，膝盖呈90度。</li><li>主动找到并感知您足底的<strong>三个核心支撑点</strong>：大脚趾根部、小脚趾根部，以及脚后跟的中心。</li><li>有意识地将这三个点均匀地压向地面。</li><li><strong>核心步骤：</strong>在保持这三点紧压地面的前提下，想象用整个脚底去“吸住”或“抓住”地面，但<strong>脚趾保持放松伸展，绝不弯曲</strong>。</li><li>您会感觉到足弓有轻微的向上隆起和收紧感。保持这个<strong>等长收缩</strong>5-10秒。</li><li>缓慢地完全放松，重复进行。</li></ol>`, errorWhy: `<p><strong>弯曲脚趾来“抓地”：</strong>这是最常见的代偿，因为控制脚趾弯曲的肌肉（足外在肌）更强大、更容易被调用，而我们想训练的是深层的足底内在肌。</p>`, solution: `<p><strong>• 纠错策略一 (视觉与意念):</strong> 眼睛始终盯着脚趾，确保它们放松伸展。将意念从“抓”改为“**用脚心吸起一张纸**”或“**让足弓像吸盘一样吸住地面**”。</p><p><strong>• 纠错策略二 (触觉反馈):</strong> 用您的手指放在足弓下方，当您正确发力时，您应该能感觉到足弓向上顶您的手指，而脚趾并没有动。</p><p><strong>• 您的个性化工具箱 (退阶训练):</strong> <ul class="list-disc list-inside mt-1"><li><strong>分离控制训练：</strong>如果总是忍不住用脚趾，先做这个练习来分离控制：保持三点支撑，只练习轻轻地将所有脚趾向上抬起（脚掌不动），再轻轻放下。这能教会您的大脑“脚趾”和“足弓”是两回事。</li><li><strong>带入生活：</strong>尝试在排队或站立时，有意识地建立足底三点支撑的感觉，让它成为一种习惯。</li><li><strong>强度控制：</strong>如果出现抽筋，说明发力过猛。放松，甩甩脚，然后只用10-20%的力气去尝试。</li></ul></p>` },
            'ankle-stability': { module: 3, title: '单脚稳定与重心转移训练', target: '在一个安全、可控的环境中，唤醒并训练负责踝关节左右稳定性的深层肌肉。', principle: '我们采用“**有辅助的单脚站立**”，消除平衡难题，让您可以将全部注意力集中在脚踝上。当进行微小重心转移时，负责防止脚踝内外翻的肌肉（腓骨长短肌、胫后肌）必须进行快速、精细的收缩来维持稳定。', benefit: '这是对“足部三点支撑”的直接升级。它教会您的踝关节如何在动态扰动中保持中立，是预防崴脚、为未来跑跳建立安全基础的关键一环。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>赤脚站立，旁边放一把椅子或靠近墙壁，以便<strong>随时用手轻轻扶住</strong>。</li><li>先在双脚站立时，完成“足部三点支撑与抓地”练习。</li><li>将重心缓慢转移到一侧腿上，另一脚轻轻抬离地面，<strong>手上始终保持轻扶</strong>。</li><li><strong>第一阶段（静态保持）：</strong>保持姿势，注意力放在支撑脚的脚踝上。目标是让脚踝尽可能稳定。保持15-30秒。</li><li><strong>第二阶段（动态挑战）：</strong>在能稳定保持后，尝试进行极其微小的、有控制的重心转移（前、后、左、右）。</li></ol>`, errorWhy: `<p><strong>1. 脚踝剧烈晃动：</strong>踝关节的深层稳定肌群力量和神经控制能力不足，这恰好是我们要训练它的原因。</p><p><strong>2. 用手死死抓住支撑物：</strong>缺乏安全感，但这样重量没有完全给到脚踝，失去了训练意义。</p><p><strong>3. 注意力分散：</strong>大脑倾向于关注宏观平衡，而非局部的肌肉控制。</p>`, solution: `<p><strong>• 策略一 (管理晃动):</strong> 接受初期的轻微晃动，这是肌肉在学习。不要与之对抗，而是尝试去**控制**它，让晃动变得更慢、幅度更小。</p><p><strong>• 策略二 (调整辅助):</strong> 遵循**“钢琴手”原则**——想象您的手是在弹钢琴，只是用指尖轻轻搭在支撑物上，提供一个安全备份，而不是用它来承重。您的目标是逐渐减少对辅助的依赖。</p><p><strong>• 策略三 (锁定焦点):</strong> 将您的目光和意念都锁定在支撑脚的脚踝上。同时，在前方墙壁上找一个固定的点进行注视，这能极大地帮助您稳定。</p><p><strong>• 您的个性化工具箱 (退阶与进阶):</strong> <ul class="list-disc list-inside mt-1"><li><strong>退阶：“脚尖点地”辅助：</strong>如果静态保持都非常困难，这是最佳的退阶选择。将抬起的那只脚的脚尖轻轻点在支撑脚的旁边地面上，这能分担一小部分重量，极大地降低难度。</li><li><strong>进阶：闭眼挑战。</strong>在能轻松完成动态挑战后，尝试闭上眼睛进行静态保持（务必确保旁边有可靠支撑物），这会完全剥夺您的视觉输入，迫使踝关节的本体感觉系统加倍工作。</li><li><strong>疼痛处理：</strong>如果脚踝的任何位置出现尖锐疼痛，立即停止。首先检查您的“足部三点支撑”是否依然有效。如果疼痛持续，说明此动作对您来说为时过早，应专注于“足部三点支撑”和“靠墙静蹲”。</li></ul></p>` },
            'wall-sit': { module: 3, title: '靠墙静蹲', target: '在一个对膝关节绝对安全的闭链环境中，通过等长收缩强化股四头肌和臀肌的力量，提升膝关节的稳定性。', principle: '“靠墙静蹲”是经典的等长收缩训练。背部和髋部被墙壁支撑，膝关节不会承受剪切力和摩擦。这让我们能在零风险情况下，让稳定膝关节的肌肉长时间、高强度地工作。', benefit: '这是直接针对您膝盖疼痛和不稳问题的安全高效方案。强化股四头肌，等于给膝盖骨安装了强大的“稳定器”。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>背靠墙壁站立，双脚分开与髋同宽，脚尖朝前，脚掌距离墙壁约一到两脚的距离。</li><li>保持背部紧贴墙面，核心收紧，身体沿墙壁缓慢向下滑动，直到您的大腿与地面平行（或在您感到舒适、无痛的最高角度）。</li><li>检查姿势：膝盖应位于脚踝的正上方，小腿与地面垂直。</li><li>将重心均匀分布在整个脚掌上，感觉大腿前侧和臀部肌肉正在持续发力。</li><li>保持姿势，平稳呼吸，持续30-60秒，或直到无法维持标准姿势为止。</li><li>完成后，用手支撑墙壁，缓慢地将身体推回站立姿势。</li></ol>`, errorWhy: `<p><strong>1. 膝盖内扣：</strong>臀中肌无力的直接体现，身体在重复这个错误的力学模式。</p><p><strong>2. 膝盖疼痛：</strong>下蹲角度过大，超出了当前关节的承受能力，或是力线不正。</p><p><strong>3. 用脚尖发力过多：</strong>这会过多激活股四头肌，减少臀肌的参与，并且增加对膝关节的压力。</p>`, solution: `<p><strong>• 纠正膝内扣:</strong> 在开始前，主动想象要“将地面向两侧撕裂”，这能预激活您的臀部外旋肌。如果问题依然存在，可以在两膝之间夹一个枕头并向内夹紧，或者在膝盖外侧套上弹力带并主动向外撑开。</p><p><strong>• 消除疼痛 (绝对优先):</strong> 立即减小下蹲的深度。您的目标是找到一个**完全无痛的角度**。哪怕只下蹲几厘米，只要能感觉到大腿发力且膝盖无痛，就是正确的。质量永远比幅度重要。</p><p><strong>• 调整重心:</strong> 确保重心在**足中部**。有意识地用**脚后跟**向下发力，想象要把鞋子踩穿。您甚至可以尝试稍微抬起脚趾，以确保重心在后方。</p><p><strong>• 您的个性化工具箱:</strong> <ul class="list-disc list-inside mt-1"><li><strong>核心参与：</strong>在下蹲前，轻轻收腹，想象下背部有一个徽章，您需要把它平整地印在墙上，整个过程都不要让它拱起。</li><li><strong>非对称调整：</strong>如果只有一侧膝盖不适，可以尝试将感觉不适的那一侧脚稍微向前移动一点点（约半个脚掌距离）。</li><li><strong>时间换强度：</strong>如果即使在很高的角度也无法保持30秒，那就改为保持15秒，但增加组数。</li></ul></p>` },
            'glute-bridge': { module: 4, title: '臀桥', target: '唤醒并强化臀大肌，重建正确的伸髋模式。', principle: '臀大肌是人体最有力的伸髋肌群。在您的案例中，它处于“沉睡”状态，导致伸髋的任务被腰部和腘绳肌代偿。臀桥是唤醒它的最直接方式。', benefit: '一个强有力的臀部能稳定骨盆，直接减轻膝关节和腰椎的压力。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>仰卧，屈膝，双脚与髋同宽平放于地，脚尖朝前。</li><li>首先做一个轻微的骨盆后倾，将下背部压向地面。</li><li>保持骨盆后倾，以“用脚后跟蹬地，将臀部推向天花板”为意念启动动作。</li><li>在顶峰时，应感觉臀部肌肉强烈收缩，而下背部和腘绳肌没有明显发力感。</li><li>缓慢下放，重复进行。</li></ol>`, errorWhy: `<p><strong>1. 用腰代偿：</strong>身体默认使用最强的肌肉（下背部）完成任务。</p><p><strong>2. 腘绳肌抽筋：</strong>它试图帮助无力的臀肌，导致负荷过大。</p><p><strong>3. 左髋前侧疼痛：</strong>伸髋末端可能存在关节撞击或软组织挤压。</p>`, solution: `<p><strong>• “两步启动法”:</strong> 这是解决腰部代偿的关键。**第一步（倾斜）：**呼气，收紧腹部，将下背部完全压向地面（完成骨盆后倾）。保持住。**第二步（挤压抬起）：**保持骨盆后倾的状态，然后专注于“用臀部肌肉发力去夹紧”，让这个夹紧的力量把您的臀部向上推起。</p><p><strong>• 解决腘绳肌抽筋:</strong> 除了将脚后跟向臀部靠近，还可以在抬起前，先主动、有意识地挤压臀部肌肉，感受它变硬，然后再用脚后跟发力。确保臀部是第一个“开工”的。</p><p><strong>• 应对左髋疼痛 (最高优先级):</strong> 这是绝对的停止信号。您需要立刻**放弃所有抬起的动作**，执行下面的退阶版本。</p><p><strong>• 您的个性化工具箱 (退阶训练):</strong> <ul class="list-disc list-inside mt-1"><li><strong>等长臀桥：</strong>这是您目前最安全的版本。完成“两步启动法”中的第一步（骨盆后倾），然后想象要向上抬起，全力收紧臀部肌肉，但**臀部保持不离开地面**。目标是只感受臀部强烈的收缩感，而髋关节不产生任何运动。保持收缩5-10秒，然后放松。</li></ul></p>` },
            'clamshell': { module: 4, title: '蚌式开合', target: '精准激活臀中肌，学习髋外旋控制。', principle: '此动作精准激活臀中肌，它是稳定骨盆侧方的关键。其无力是您膝盖内扣的直接原因。', benefit: '强化臀中肌，就是直接修复导致您膝痛的错误力学模式。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>身体侧卧，双腿屈膝交叠，脚后跟、臀部、上背部大致在一条直线上。</li><li>保持骨盆绝对静止（想象骨盆上下两点被钉在一起）和双脚并拢的情况下，缓慢地将上方的膝盖抬起。</li><li>在顶端感受臀部侧后方肌肉的酸胀感，稍作停留后缓慢下放。</li></ol>`, errorWhy: `<p><strong>1. 骨盆随膝盖一起向后翻倒：</strong>用整个躯干的转动来“作弊”，以弥补髋关节外旋能力的不足。</p><p><strong>2. 感觉大腿前侧或外侧酸胀：</strong>阔筋膜张肌（TFL）在代偿，它是臀中肌的“假朋友”，总爱抢着干活。</p>`, solution: `<p><strong>• 动作纯净度检查:</strong> 将您的上手放在髋骨上，它就是你的“裁判”，在整个动作中纹丝不动。同时，将动作幅度**减小到只有原来的1/3**，甚至更小。这个动作的精髓在于精准，而非幅度。</p><p><strong>• 抑制TFL代偿:</strong> 在开始前，找到您的TFL（裤子前口袋区域的肌肉），用手指轻轻按摩30秒，告诉它“你可以休息了”。然后，将意念从“抬起膝盖”改为“**用臀部侧后方的肌肉，像旋转钥匙一样，把大腿骨向外转动**”。</p><p><strong>• 您的个性化工具箱 (终极退阶):</strong> <ul class="list-disc list-inside mt-1"><li><strong>靠墙练习：</strong>这是最好的纠错工具。将您的背部和臀部完全紧贴墙壁进行练习，墙壁会提供一个物理屏障，**绝对不允许您的骨盆向后滚动**。在这个姿势下，即使幅度很小，也能确保是目标肌肉在发力。</li></ul></p>` },
            'scapular-pushup': { module: 4, title: '四点支撑肩胛骨推移', target: '在安全的位置下，重新建立大脑与肩胛稳定肌（尤其是前锯肌）的神经连接，并温和地提升胸椎活动度。', principle: '我们不是在等脊柱变直，而是在您当前的身体条件下，通过主动的肩胛骨运动来“唤醒”沉睡的前锯肌。这个动作能打破“胸椎僵硬-肩胛不稳-稳定肌无力”的恶性循环。', benefit: '它能精准地、孤立地训练肩胛骨在胸廓上的滑动能力，这是对抗翼状肩胛、改善肩颈紧张的第一步。同时，这个前后滑动的过程本身，就是一个安全、有效的胸椎动态活动度练习，两者相辅相成。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>采取四点跪姿，双手位于肩膀正下方，膝盖位于髋部正下方，保持背部中立。</li><li><strong>核心要点：</strong>在整个过程中，<strong>保持您的肘关节完全伸直</strong>，核心收紧，避免腰部下塌或拱起。</li><li><strong>第一步（后缩/下沉）：</strong>缓慢地让您的胸骨向地面下沉，想象将两块肩胛骨向脊柱方向相互挤压。您会感觉到上背部的肌肉被“夹”在一起。</li><li><strong>第二步（前伸/上推）：</strong>然后，用力推地，将您的上背部尽可能地向上拱起，推向天花板，想象让两块肩胛骨相互远离，并包裹住胸廓的两侧。这个“上推”的动作是激活前锯肌的关键。</li><li>动作幅度可能很小，关键在于感受肩胛骨的滑动，而非手臂或腰部的运动。</li></ol>`, errorWhy: `<p><strong>1. 弯曲手肘：</strong>这是最常见的代偿，用手臂的力量代替了肩胛的运动。</p><p><strong>2. 腰部晃动或拱起/下塌：</strong>核心没有保持稳定，动作变成了全身的晃动。</p>`, solution: `<p><strong>• 锁定手肘技巧:</strong> 在动作开始前，有意识地将肘关节“锁死”，并可以尝试稍微向外旋转您的手掌，让手指尖朝向外侧一点，这有助于“旋紧”您的肩关节，让手肘更难弯曲。</p><p><strong>• 核心稳定优先:</strong> 将注意力放在保持腹部收紧上，想象从头到尾骨是一条平直的、不会动的木板。如果需要，可以在下背部放一个水杯或手机作为反馈。</p><p><strong>• 您的个性化工具箱:</strong> <ul class="list-disc list-inside mt-1"><li><strong>避免耸肩：</strong>在整个动作中，有意识地让肩膀远离耳朵，想象脖子在变长。</li><li><strong>感受优先：</strong>如果难以控制，就只做非常非常小的滑动，直到能清晰地感觉到是肩胛骨在动，而不是其他任何地方。</li><li><strong>手腕疼痛？</strong>这是常见的初期问题。退阶方案是：将双手握拳，用拳面支撑；或者将手掌放在瑜伽砖或厚书上，以减少手腕的背伸角度。</li></ul></p>` },
            'bird-dog': { module: 4, title: '鸟狗式', target: '训练核心在面对肢体运动时“抵抗旋转”和“抵抗伸展”的能力。', principle: '核心肌群必须以等长收缩的方式全力工作，以防止脊柱弯曲或旋转，为所有四肢运动提供坚如磐石的中心平台。', benefit: '保护腰椎，为所有未来的复合运动建立稳定的基础。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>从四点跪姿开始，双手在肩正下方，膝盖在髋正下方。</li><li>收紧核心，想象背上放着一杯水。</li><li>缓慢地将右手臂向前伸直，同时将左腿向后伸直，直到手臂、躯干和腿形成一条直线。</li><li>保持这个姿势2-3秒，感受核心的稳定。</li><li>缓慢地回到起始位置，然后换边重复。</li></ol>`, errorWhy: `<p><strong>1. 腰部下塌，骨盆晃动：</strong>核心肌群没有能成功地“锁定”脊柱和骨盆，无法抵抗肢体运动产生的扰动力矩。</p><p><strong>2. 追求高度而非长度：</strong>这是一个误区，这个动作的目标是训练“在伸展中保持稳定”，而不是柔韧性。</p>`, solution: `<p><strong>• 启动前预备 (Pre-Bracing):</strong> 在移动任何肢体之前，先做一次完整的呼气，感受腹部向内收紧，然后保持这个“腹部护甲”，再开始缓慢地移动。</p><p><strong>• 意念引导升级:</strong> 想象您的头顶、伸出的手和伸出的脚后跟上各有一个激光笔。您的目标是在整个动作中，让这三个激光点在墙上画出三条尽可能远、尽可能平稳的直线。</p><p><strong>• 您的个性化工具箱 (退阶层级):</strong> <ul class="list-decimal list-inside mt-1"><li><strong>第一级（最低难度）：</strong>只在地面上向后滑动一条腿，脚尖不离地。</li><li><strong>第二级：</strong>只在地面上向前滑动一只手臂。</li><li><strong>第三级：</strong>将一条腿抬离地面几厘米，保持。</li><li><strong>第四级：</strong>将一只手臂抬至与躯干平行，保持。</li><li><strong>第五级：</strong>只有在前面四个等级都能在核心绝对稳定的情况下完成时，再尝试进行标准的对侧手脚抬起。</li></ul></p>` },
            'hip-flexor-stretch': { module: 5, title: '跪姿髋屈肌拉伸', target: '拉伸因久坐而紧张的髋屈肌（髂腰肌、股直肌）。', principle: '通过主动后倾骨盆并收紧臀肌，可以更精准、更安全地拉伸到目标肌肉，而不是通过腰椎过度伸展来代偿。', benefit: '缓解下背部紧张，改善骨盆前倾姿态，为正确的伸髋模式（如走路、跑步、深蹲）打好基础。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>取一个高跪姿，一腿在前，一腿在后，后侧膝盖着地（可在下方垫软垫）。</li><li><strong>核心步骤：</strong>收紧后侧腿的臀部和腹部，感觉骨盆在做一个轻微的后倾（仿佛尾巴要向前卷）。</li><li>在保持这个后倾姿势的前提下，身体作为一个整体缓慢前移，直到感觉到后侧大腿前侧有清晰的牵拉感。</li><li>保持30-45秒，进行深长的呼吸。</li></ol>`, solution: `<p><strong>• “7分感”黄金法则:</strong> 将不适感分为10分，您应该只拉伸到“**感觉到了清晰、明确的牵拉，但完全不痛，可以轻松地进行深呼吸和正常对话**”的感觉。</p><p><strong>• 利用呼吸“解锁”肌肉:</strong> 这是拉伸的精髓。在保持拉伸姿势时，用鼻子深吸气，感觉腹部和胸腔扩张；然后用嘴巴缓慢、完整地呼气，想象这股气息正吹向您感觉最紧张的区域，让它随着呼气“融化”和“下沉”得更深一点点。</p><p><strong>• 您的个性化工具箱 (针对性技巧):</strong> <ul class="list-disc list-inside mt-1"><li><strong>髋部有挤压感？</strong>这是关节撞击的信号。解决方法：在向前推髋之前，先**尽全力收紧后侧腿的臀部肌肉**，再温和地前移。这个“臀肌发力”的动作会把股骨头在髋臼里向后轻微拉动，为关节前侧创造空间。</li></ul></p>` },
            'figure-four-stretch': { module: 5, title: '仰卧4字拉伸', target: '拉伸臀部深层外旋肌群（如梨状肌），缓解髋部后方紧张和潜在的坐骨神经刺激。', principle: '通过仰卧姿势固定脊柱，可以确保拉伸的力量精准地作用于髋关节，避免了站姿拉伸中可能出现的腰椎代偿。', benefit: '改善髋关节外旋灵活性，降低因臀部肌肉紧张导致的下背痛或腿麻风险。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>仰卧，双腿屈膝，双脚平放于地。</li><li>将一侧的脚踝交叉放到另一侧的大腿上，靠近膝盖的位置，形成一个“4”字形。</li><li>将双手穿过腿部的空隙，抱住下方大腿的后侧。</li><li>缓慢地将下方大腿拉向胸口，直到感觉交叉腿的臀部有清晰的牵拉感。</li><li>保持30-45秒，进行深长的呼吸。</li></ol>`, solution: `<p>参考“7分感”黄金法则与呼吸技巧。</p><ul class="list-disc list-inside mt-2"><li><strong>保护膝盖：</strong>在整个过程中，保持被拉伸侧的脚（放在大腿上的那只脚）的脚踝处于轻微“勾脚”的状态，这有助于稳定膝关节。</li><li><strong>感觉不深？</strong>可以尝试将支撑脚踩在墙上或椅子上，通过调整身体与墙的距离来精确控制拉伸的强度。</li><li><strong>抱大腿困难？</strong>可以用毛巾或拉力带套在下方大腿后侧，用手拉住毛巾两端辅助。</li></ul></p>` },
            'doorway-stretch': { module: 5, title: '门框胸肌拉伸', target: '针对性地拉伸因长期伏案或圆肩姿势而紧张的胸大肌和胸小肌。', principle: '利用门框提供稳定的支撑点，允许身体前倾来安全、有效地拉长胸部肌纤维。', benefit: '改善圆肩驼背姿态，打开胸腔，缓解肩颈紧张，提升呼吸效率。', guide: `<ol class="list-decimal list-inside text-gray-300"><li>站在一个门框前。</li><li><strong>选择手臂高度以针对不同肌纤维：</strong><ul class="list-disc list-inside ml-4 my-2"><li><strong>中胸（通用）：</strong>将手臂弯曲呈90度（像投降的姿势），前臂和小臂贴在门框上，手肘与肩膀大致同高。</li><li><strong>下胸：</strong>将手臂抬得更高一点，约120度。</li><li><strong>上胸/肩前束：</strong>将手臂放得更低一点，约45度。</li></ul></li><li>同侧的脚向前迈出一小步，身体作为一个整体缓慢前倾，避免腰部前凸。</li><li>直到感觉胸部和肩膀前侧有清晰的牵拉感。</li><li>保持30-45秒，进行深长的呼吸。</li></ol>`, solution: `<p>参考“7分感”黄金法则与呼吸技巧。</p><ul class="list-disc list-inside mt-2"><li><strong>避免耸肩：</strong>在整个过程中，有意识地让肩膀下沉，远离耳朵。</li><li><strong>肩部前方有尖锐疼痛？</strong>立即停止，这可能是撞击信号。首先尝试调整手臂的高度，通常放低手臂会更安全。如果任何角度都痛，则放弃此动作。</li><li><strong>感受全身：</strong>这不是一个孤立的胸部拉伸，尝试在拉伸时也保持核心的轻微收紧，避免身体过度扭转。</li></ul></p>` }
        };

        const schedule = [
            { id: 'foam-roll', name: '泡沫轴松解 (股四头肌 & TFL)', quant: '1-2分钟/侧' },
            { id: 'breathing', name: '90/90呼吸', quant: '5组x5次呼吸' },
            { id: 'tripod-foot', name: '足部三点支撑抓地', quant: '3组x5-10秒' },
            { id: 'ankle-stability', name: '单脚稳定训练', quant: '15-30秒/侧' },
            { id: 'wall-sit', name: '靠墙静蹲', quant: '3组x30-60秒' },
            { id: 'glute-bridge', name: '臀桥', quant: '3组x15次' },
            { id: 'clamshell', name: '蚌式开合', quant: '3组x15次/侧' },
            { id: 'scapular-pushup', name: '四点支撑肩胛推移', quant: '3组x12次' },
            { id: 'bird-dog', name: '鸟狗式', quant: '3组x8次/侧' },
            { id: 'hip-flexor-stretch', name: '跪姿髋屈肌拉伸', quant: '2组x30-45秒/侧' },
            { id: 'figure-four-stretch', name: '仰卧4字拉伸', quant: '2组x30-45秒/侧' },
            { id: 'doorway-stretch', name: '门框胸肌拉伸', quant: '2组x30-45秒/侧' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // --- Element Selectors ---
            const tabsContainer = document.getElementById('tabs-container');
            const tabContentContainer = document.getElementById('tab-content-container');
            const taskList = document.getElementById('task-list');
            const journalInput = document.getElementById('journal-input');
            const saveJournalEntryButton = document.getElementById('save-journal-entry');
            const journalEntriesContainer = document.getElementById('journal-entries');
            const backgroundContainer = document.querySelector('.background-container');
            
            // Modal selectors
            const modalOverlay = document.getElementById('modal-overlay');
            const mainModalContainer = document.getElementById('modal-container');
            const mainModalContent = document.getElementById('modal-content');
            const mainModalCloseButton = document.getElementById('modal-close-button');
            const journalEditModal = document.getElementById('journal-edit-modal');
            const journalEditInput = document.getElementById('journal-edit-input');
            const journalEditSaveButton = document.getElementById('journal-edit-save');
            const journalEditCancelButton = document.getElementById('journal-edit-cancel');
            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const deleteConfirmButton = document.getElementById('delete-confirm-button');
            const deleteConfirmCancelButton = document.getElementById('delete-confirm-cancel');

            // --- State and Storage ---
            let tasksState = {};
            const journalStorageKey = 'rehab_journal_entries';
            let entryToModifyTimestamp = null;

             // --- Image Orb Cycling ---
            const imageUrls = [
                'https://i.pinimg.com/originals/1f/4a/03/1f4a032c61aba66fff3daaf26dceba6b.gif',
                'https://i.pinimg.com/736x/3f/03/e4/3f03e4cfffd1c809b95b768c9ade2026.jpg',
                'https://i.imgur.com/IsyXuM0.png',
                'https://i.pinimg.com/736x/cd/af/20/cdaf20803fb4575ba6b7181f1ea53e15.jpg',
                'https://i.pinimg.com/originals/49/ac/ab/49acabdb9efbcf9fd7f3ba9a6a7a4cdd.gif',
                'https://i.postimg.cc/503F2FzC/b351e8ae8815ba03549d49ec659a17b.jpg',
                'https://i.pinimg.com/originals/97/b0/6e/97b06e3b1dc8fa4a40066fbc57e24d82.gif',
                'https://i.pinimg.com/736x/95/18/55/951855597e5f63620a42572adf82026c.jpg'
            ];
            let currentImageIndex = 0;
            let activeOrbIndex = 0;
            const imageOrbContainer = document.getElementById('image-orb-container');
            const activeOrbs = [];
            
            function smartImageLoader(urlsToLoad, callback) {
                let loadedCount = 0;
                if (urlsToLoad.length === 0) {
                    callback();
                    return;
                }
                urlsToLoad.forEach(url => {
                    const img = new Image();
                    img.src = url;
                    img.onload = img.onerror = () => {
                        loadedCount++;
                        if (loadedCount === urlsToLoad.length) {
                            callback();
                        }
                    };
                });
            }

            function initImageOrbs() {
                for(let i=1; i<=3; i++) {
                    const orb = document.createElement('div');
                    orb.className = `image-orb orb-${i}`;
                    
                    const bg1 = document.createElement('div');
                    bg1.className = 'orb-bg';
                    
                    const bg2 = document.createElement('div');
                    bg2.className = 'orb-bg is-fading';

                    orb.appendChild(bg1);
                    orb.appendChild(bg2);
                    imageOrbContainer.appendChild(orb);
                    activeOrbs.push(orb);

                    bg1.style.backgroundImage = `url('${imageUrls[currentImageIndex]}')`;
                    currentImageIndex = (currentImageIndex + 1) % imageUrls.length;
                }
            }
            
            function updateOrbImage(orb) {
                const newImageUrl = imageUrls[currentImageIndex];
                currentImageIndex = (currentImageIndex + 1) % imageUrls.length;
                
                // Preload the next image before transition
                const img = new Image();
                img.src = newImageUrl;
                img.onload = () => {
                    const fadingOutBg = orb.querySelector('.orb-bg:not(.is-fading)');
                    const fadingInBg = orb.querySelector('.orb-bg.is-fading');
                    
                    fadingInBg.style.backgroundImage = `url('${newImageUrl}')`;
                    
                    fadingOutBg.classList.add('is-fading');
                    fadingInBg.classList.remove('is-fading');
                };
            }

            function cycleImages() {
                const orbToUpdate = activeOrbs[activeOrbIndex];
                updateOrbImage(orbToUpdate);
                activeOrbIndex = (activeOrbIndex + 1) % activeOrbs.length;
            }

            // --- Task List Functions ---
            function getTaskStorageKey() {
                const today = new Date().toISOString().split('T')[0];
                return `rehab_tasks_${today}`;
            }

            function loadTasks() {
                const savedTasks = localStorage.getItem(getTaskStorageKey());
                tasksState = savedTasks ? JSON.parse(savedTasks) : {};
                renderTaskList();
            }
            
            function saveTasks() {
                localStorage.setItem(getTaskStorageKey(), JSON.stringify(tasksState));
            }

            function renderTaskList() {
                taskList.innerHTML = '';
                schedule.forEach(task => {
                    const isChecked = tasksState[task.id] || false;
                    const taskHTML = `
                        <div class="task-item">
                            <input type="checkbox" id="task-${task.id}" class="task-checkbox hidden" ${isChecked ? 'checked' : ''}>
                            <div class="task-container flex items-center w-full p-4 rounded-xl transition-all duration-400">
                                <label for="task-${task.id}" class="task-circle-label flex-shrink-0">
                                    <div class="task-circle w-6 h-6 border-2 rounded-full mr-4 flex items-center justify-center flex-shrink-0 cursor-pointer"></div>
                                </label>
                                <span class="task-text flex-grow open-modal-button relative z-10 cursor-pointer" data-id="${task.id}">${task.name}</span>
                                <span class="font-mono text-sm text-cyan-200 bg-cyan-500/20 px-3 py-1 rounded-full ml-auto whitespace-nowrap relative z-10">${task.quant}</span>
                            </div>
                        </div>`;
                    taskList.insertAdjacentHTML('beforeend', taskHTML);
                });

                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        tasksState[checkbox.id.replace('task-', '')] = checkbox.checked;
                        saveTasks();
                    });
                });
            }
            
            // --- Journal Functions ---
            function getJournalEntries() { return JSON.parse(localStorage.getItem(journalStorageKey) || '[]'); }
            function saveJournalEntries(entries) { localStorage.setItem(journalStorageKey, JSON.stringify(entries)); }

            function renderJournalEntries() {
                journalEntriesContainer.innerHTML = '';
                const entries = getJournalEntries();
                entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                entries.forEach(entry => {
                    const entryDate = new Date(entry.date);
                    const formattedDate = `${entryDate.getFullYear()}年${entryDate.getMonth() + 1}月${entryDate.getDate()}日 ${entryDate.toLocaleTimeString('zh-CN', { hour: '2-digit', minute:'2-digit' })}`;
                    const entryHTML = `
                        <div class="bg-black/20 p-4 rounded-lg border border-white/10" data-timestamp="${entry.date}">
                            <p class="text-sm font-semibold text-cyan-300 mb-2">${formattedDate}</p>
                            <p class="text-slate-300 whitespace-pre-wrap break-words mb-3">${entry.content}</p>
                            <div class="journal-actions flex gap-2 justify-end">
                                <button class="edit-journal-btn text-xs py-1 px-3 rounded-md">修改</button>
                                <button class="delete-journal-btn text-xs py-1 px-3 rounded-md">删除</button>
                            </div>
                        </div>`;
                    journalEntriesContainer.insertAdjacentHTML('beforeend', entryHTML);
                });
            }

            saveJournalEntryButton.addEventListener('click', () => {
                const content = journalInput.value.trim();
                if (content === '') return;
                const entries = getJournalEntries();
                entries.push({ date: new Date().toISOString(), content: content });
                saveJournalEntries(entries);
                journalInput.value = '';
                renderJournalEntries();
            });
            
            journalEntriesContainer.addEventListener('click', e => {
                const entryElement = e.target.closest('[data-timestamp]');
                if (!entryElement) return;
                entryToModifyTimestamp = entryElement.dataset.timestamp;

                if (e.target.matches('.edit-journal-btn')) {
                    const entries = getJournalEntries();
                    const entryToEdit = entries.find(entry => entry.date === entryToModifyTimestamp);
                    if (entryToEdit) {
                        journalEditInput.value = entryToEdit.content;
                        showModal(journalEditModal);
                    }
                } else if (e.target.matches('.delete-journal-btn')) {
                    showModal(deleteConfirmModal);
                }
            });

            journalEditSaveButton.addEventListener('click', () => {
                let entries = getJournalEntries();
                const entryIndex = entries.findIndex(entry => entry.date === entryToModifyTimestamp);
                if (entryIndex > -1) {
                    entries[entryIndex].content = journalEditInput.value.trim();
                    saveJournalEntries(entries);
                    renderJournalEntries();
                    hideAllModals();
                }
            });
            journalEditCancelButton.addEventListener('click', hideAllModals);

            deleteConfirmButton.addEventListener('click', () => {
                let entries = getJournalEntries();
                const updatedEntries = entries.filter(entry => entry.date !== entryToModifyTimestamp);
                saveJournalEntries(updatedEntries);
                renderJournalEntries();
                hideAllModals();
            });
            deleteConfirmCancelButton.addEventListener('click', hideAllModals);

            // --- Module Content & Tabs ---
            function renderModuleContent() {
                for(let i=1; i<=5; i++){
                    const moduleContainer = document.getElementById(`tab-module${i}`);
                    moduleContainer.innerHTML = '';
                    const moduleExercises = Object.entries(exerciseData).filter(([_, data]) => data.module === i);
                    if(moduleExercises.length > 0) {
                         const exerciseList = document.createElement('div');
                         exerciseList.className = 'space-y-4';
                         moduleExercises.forEach(([id, data]) => {
                             exerciseList.innerHTML += `<button class="module-button open-modal-button w-full text-left p-5 rounded-xl shadow-sm flex justify-between items-center" data-id="${id}"><span class="relative z-10 font-semibold text-lg">${data.title}</span><svg xmlns="http://www.w3.org/2000/svg" class="relative z-10 h-6 w-6 text-cyan-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></button>`;
                         });
                         moduleContainer.appendChild(exerciseList);
                    }
                }
            }

            tabsContainer.addEventListener('click', (e) => {
                const button = e.target.closest('.tab');
                if (button) {
                    const tabId = button.dataset.tab;
                    tabsContainer.querySelectorAll('.tab').forEach(tab => tab.classList.replace('tab-active', 'tab-inactive'));
                    button.classList.replace('tab-inactive', 'tab-active');
                    tabContentContainer.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                    document.getElementById(`tab-${tabId}`).classList.remove('hidden');
                }
            });

            // --- Generic Modal Functions ---
            function showModal(modalElement) {
                modalOverlay.style.display = 'flex';
                setTimeout(() => {
                    modalOverlay.classList.remove('opacity-0');
                    modalElement.classList.remove('hidden');
                    
                    // BUG FIX: Intelligently apply display style
                    // Apply 'flex' only to modals designed with flex-col, otherwise use 'block'.
                    // This prevents breaking the layout of the main content modal.
                    if (modalElement.classList.contains('flex-col')) {
                        modalElement.style.display = 'flex';
                    } else {
                        modalElement.style.display = 'block';
                    }
                    
                    setTimeout(() => {
                       modalElement.classList.remove('opacity-0', 'scale-95');
                    }, 10);
                }, 10);
            }

            function hideAllModals() {
                 modalOverlay.classList.add('opacity-0');
                 mainModalContainer.classList.add('opacity-0', 'scale-95');
                 journalEditModal.classList.add('opacity-0', 'scale-95');
                 deleteConfirmModal.classList.add('opacity-0', 'scale-95');
                 setTimeout(() => {
                    modalOverlay.style.display = 'none';
                    mainModalContainer.classList.add('hidden');
                    journalEditModal.classList.add('hidden');
                    deleteConfirmModal.classList.add('hidden');

                    // BUG FIX: Reset inline styles on close to prevent style pollution
                    mainModalContainer.style.display = '';
                    journalEditModal.style.display = '';
                    deleteConfirmModal.style.display = '';
                 }, 300);
            }

            function openMainModal(id) {
                const data = exerciseData[id];
                if (!data) return;
                mainModalContainer.style.display = 'block';
                const moduleAccentColors = { 1: 'border-cyan-400', 2: 'border-emerald-400', 3: 'border-amber-400', 4: 'border-violet-400', 5: 'border-rose-400' };
                mainModalContent.innerHTML = `<h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-cyan-400 mb-6">${data.title}</h2><div class="space-y-8 text-gray-300"><div><h4 class="font-semibold text-xl text-white border-b-2 ${moduleAccentColors[data.module] || 'border-slate-400'} pb-2 mb-3">训练目标</h4><p>${data.target}</p></div>${data.principle ? `<div><h4 class="font-semibold text-xl text-white border-b-2 ${moduleAccentColors[data.module] || 'border-slate-400'} pb-2 mb-3">动作原理与它如何帮助你</h4><div class="prose prose-sm max-w-none"><ul><li><strong>原理：</strong>${data.principle}</li><li><strong>如何帮助你：</strong>${data.benefit}</li></ul></div></div>` : ''}${data.guide ? `<div><h4 class="font-semibold text-xl text-white border-b-2 ${moduleAccentColors[data.module] || 'border-slate-400'} pb-2 mb-3">事无巨细的执行指南</h4><div class="prose prose-sm max-w-none">${data.guide}</div></div>` : ''}<div><h4 class="font-semibold text-xl text-white border-b-2 ${moduleAccentColors[data.module] || 'border-slate-400'} pb-2 mb-3">精准纠错与个性化调整</h4><div class="mt-4 space-y-4">${data.errorWhy ? `<div class="bg-rose-500/20 border-l-4 border-rose-500 text-rose-200 rounded-r-lg p-4"><h5 class="font-bold">哪里容易出错 & 为什么？</h5><div class="mt-2 text-rose-200/80">${data.errorWhy}</div></div>` : ''}${data.solution ? `<div class="bg-emerald-500/20 border-l-4 border-emerald-500 text-emerald-200 rounded-r-lg p-4"><h5 class="font-bold">出错了怎么办 & 如何为我调整？</h5><div class="mt-2 text-emerald-200/90 space-y-2">${data.solution}</div></div>` : ''}</div></div></div>`;
                mainModalContent.querySelectorAll('.prose li, .prose p, .prose strong, .prose ol, .prose ul').forEach(el => el.style.color = '#d1d5db');
                showModal(mainModalContainer);
            }

            // --- Global Event Listeners ---
            document.body.addEventListener('click', (e) => {
                if (e.target.closest('.open-modal-button')) openMainModal(e.target.closest('.open-modal-button').dataset.id);
            });
            mainModalCloseButton.addEventListener('click', hideAllModals);
            modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) hideAllModals(); });

            // --- Initial Load ---
            initImageOrbs();
            smartImageLoader(imageUrls.slice(0, 3), () => {
                backgroundContainer.classList.remove('is-loading');
                setInterval(cycleImages, 10000); // Evolve one image every 10 seconds
            });

            loadTasks();
            renderModuleContent();
            renderJournalEntries();
        });
    </script>
</body>
</html>

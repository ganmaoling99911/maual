<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE MANUAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Keyframes for colored orbs (base background) */
        @keyframes float { 0%, 100% { transform: translate(0px, 0px); } 50% { transform: translate(30px, -50px); } }
        @keyframes float-2 { 0%, 100% { transform: translate(0px, 0px); } 50% { transform: translate(-40px, 40px); } }
        @keyframes float-3 { 0%, 100% { transform: translate(0px, 0px); } 50% { transform: translate(25px, 45px); } }
        /* Adjusted color cycle for more subtle background light transition */
        @keyframes color-cycle-earth { 0% { background-color: #DCD5C8; } 33% { background-color: #A39B8B; } 66% { background-color: #7D736A; } 100% { background-color: #DCD5C8; } }
        @keyframes color-cycle-sky { 0% { background-color: #87CEEB; } 50% { background-color: #B4E1F8; } 100% { background-color: #87CEEB; } }
        
        /* Keyframes for image orbs movement */
        @keyframes orb-fusion-1 { 0% { transform: translate(0, 0) scale(0.9); } 25% { transform: translate(20vw, -15vh) scale(1.1); } 50% { transform: translate(-10vw, 10vh) scale(1); } 75% { transform: translate(15vw, 20vh) scale(1.2); } 100% { transform: translate(0, 0) scale(0.9); } }
        @keyframes orb-fusion-2 { 0% { transform: translate(0, 0) scale(1.1); } 25% { transform: translate(-25vw, 10vh) scale(0.9); } 50% { transform: translate(10vw, -5vh) scale(1.2); } 75% { transform: translate(-15vw, -15vh) scale(1); } 100% { transform: translate(0, 0) scale(1.1); } }
        @keyframes orb-fusion-3 { 0% { transform: translate(0, 0) scale(1); } 25% { transform: translate(10vw, 25vh) scale(1.2); } 50% { transform: translate(-20vw, -10vh) scale(0.9); } 75% { transform: translate(5vw, -20vh) scale(1.1); } 100% { transform: translate(0, 0) scale(1); } }
        
        /* Keyframe for "Holy Light" effect on checkbox - Adjusted for natural, slower pulse */
        @keyframes holy-glow { 
            0% { box-shadow: 0 0 8px 1px rgba(255, 223, 100, 0.3); opacity: 1; } 
            50% { box-shadow: 0 0 20px 6px rgba(255, 235, 150, 0.6); opacity: 0.9; } 
            100% { box-shadow: 0 0 8px 1px rgba(255, 223, 100, 0.3); opacity: 1; } 
        }

        /* Keyframes for button glow (dynamic color) */
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0px var(--button-glow-color, rgba(255, 255, 255, 0)); }
            50% { box-shadow: 0 0 15px 5px var(--button-glow-color, rgba(173, 216, 230, 0.7)); }
            100% { box-shadow: 0 0 0px var(--button-glow-color, rgba(255, 255, 255, 0)); }
        }
        
        body {
            background-color: #000000; /* Black base for best blending */
            color: #f0f0f0;
            overflow-x: hidden;
            position: relative;
            font-family: 'Noto Sans SC', sans-serif;
        }

        /* --- Background Layers - Adjusted opacity and filters for more natural glow --- */
        .background-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -3; 
            overflow: hidden; 
            /* Subtle radial gradient overlay for deeper background */
            background: radial-gradient(circle at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.8) 100%);
        }
        .background-container.is-loading .sanctum-orb,
        .background-container.is-loading .image-orb {
            animation-play-state: paused;
        }
        /* Slightly reduce blur for a clearer, yet still ethereal effect */
        .background-base-sky { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -3; overflow: hidden; filter: blur(100px); opacity: 0.7; }
        .background-sanctum { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden; filter: blur(100px) saturate(1.1); opacity: 0.6; }
        .background-image-orb-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        
        .sanctum-orb { position: absolute; border-radius: 50%; animation-iteration-count: infinite; animation-timing-function: ease-in-out; }
        .sky-orb { animation-duration: 35s; /* Slower */ animation-name: float, color-cycle-sky; }
        .earth-orb { animation-duration: 30s; /* Slower */ animation-name: float-2, color-cycle-earth; animation-delay: 0s, 7s; }
        .base-orb-1 { width: 80vw; height: 80vw; top: -30%; left: -30%; }
        .base-orb-2 { width: 70vw; height: 70vw; bottom: -40%; right: -30%; }
        .base-orb-3 { width: 60vw; height: 60vw; bottom: -10%; left: 5%; animation-name: float-3, color-cycle-sky; animation-delay: 0s, 14s; }

        .image-orb {
            position: absolute;
            background-size: cover;
            background-position: center;
            will-change: transform;
            animation-duration: 30s; /* Slower */
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out; /* Smoother motion */
            mix-blend-mode: screen; 
            -webkit-mask-image: radial-gradient(circle, white 30%, transparent 65%);
            mask-image: radial-gradient(circle, white 30%, transparent 65%);
            opacity: 0.8; /* Slightly reduce opacity for softness */
        }
        
        .image-orb .orb-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-size: cover;
            background-position: center;
            transition: opacity 2s ease-in-out;
            opacity: 1;
        }
        .image-orb .orb-bg.is-fading {
            opacity: 0;
        }

        .orb-1 { top: -20%; left: -20%; width: 70vw; height: 70vw; animation-name: orb-fusion-1; }
        .orb-2 { top: -10%; right: -25%; width: 80vw; height: 80vw; animation-name: orb-fusion-2; }
        .orb-3 { bottom: -25%; left: 10%; width: 75vw; height: 75vw; animation-name: orb-fusion-3; }

        /* --- UI Styling --- */
        .tab-active { color: #ffffff; background-color: rgba(255, 255, 255, 0.2); box-shadow: 0 0 15px rgba(255, 255, 255, 0.1), inset 0 0 5px rgba(255, 255, 255, 0.2); }
        .tab-inactive { color: #cccccc; }
        .tab-inactive:hover { color: #ffffff; background-color: rgba(255, 255, 255, 0.1); }
        .frosted-glass { background: rgba(26, 26, 26, 0.3); backdrop-filter: blur(24px) saturate(150%); -webkit-backdrop-filter: blur(24px) saturate(150%); border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 20px 40px rgba(0,0,0,0.3); color: #f0f0f0; }
        .modal-overlay { transition: opacity 0.3s ease; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(16px); }
        
        .task-item { position: relative; transition: all 0.4s ease; background-color: rgba(255, 255, 255, 0.05); overflow: hidden; border-radius: 0.75rem; }
        .task-item:hover { transform: scale(1.02); background-color: rgba(255, 255, 255, 0.1); }
        .task-item .task-circle { border-color: #888; transition: all 0.3s ease; }
        .task-item:hover .task-circle { border-color: #ffd700; }

        .task-checkbox:checked ~ .task-container .task-text { color: #aaa; }
        .task-checkbox:checked ~ .task-container { background-color: rgba(255, 215, 0, 0.1); box-shadow: 0 0 20px 3px rgba(255, 215, 0, 0.2); opacity: 0.85; }
        .task-checkbox:checked ~ .task-container .task-circle { 
            background-image: radial-gradient(circle, rgba(255, 235, 150, 0.9) 0%, rgba(255, 215, 0, 0.4) 50%, transparent 70%);
            border-color: rgba(255, 215, 0, 0.5);
            animation: holy-glow 3s infinite ease-in-out; /* Slower and more natural */
        }
        
        .module-button { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.2); color: #f0f0f0; }
        .module-button:hover { transform: translateY(-2px); background: rgba(255, 255, 255, 0.15); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); }
        .gradient-text { background: linear-gradient(45deg, #a2d2ff, #f0f0f0, #ffafcc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
        /* Save and Export buttons - Neutral styling */
        #save-journal-entry, #export-journal-entry {
            background: rgba(255, 255, 255, 0.08); /* Light greyish transparent */
            border: 1px solid rgba(255, 255, 255, 0.15); /* Subtle border */
            color: #cccccc; /* Muted text color */
            transition: all 0.3s ease; /* Keep transition for smoothness */
        }
        #save-journal-entry:hover, #export-journal-entry:hover {
            background: rgba(255, 255, 255, 0.15); /* Slightly brighter on hover */
            border-color: rgba(255, 255, 255, 0.25); /* Slightly brighter border */
            color: #ffffff; /* Text brightens on hover */
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.05); /* Subtle white glow */
        }

        /* Dynamic Music Button Styling */
        .music-switch {
            /* Basic interactive properties */
            cursor: pointer;
            transition: all 0.4s ease-in-out;
            display: inline-block; /* Required for transforms */
        }
        .music-switch:hover {
            transform: scale(1.1); /* Slight zoom on hover */
        }
        .music-switch.playing {
            /* Overrides the .gradient-text style to create the crystal effect */
            background: none;
            -webkit-background-clip: initial;
            -webkit-text-fill-color: initial;
            color: rgba(255, 255, 255, 0.9);
            text-shadow:
                0 2px 5px rgba(0, 0, 0, 0.4),
                0 0 10px rgba(173, 216, 230, 0.8), /* Light blue glow */
                0 0 25px rgba(173, 216, 230, 0.7),
                0 0 40px rgba(173, 216, 230, 0.6),
                1px -1px 1px rgba(255, 255, 255, 1);
        }

        /* Style for the new difficulty adjustment buttons */
        .difficulty-button {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--difficulty-button-bg-color, rgba(255, 255, 255, 0.1));
            border: 1px solid var(--difficulty-button-border-color, rgba(255, 255, 255, 0.3));
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease; /* Smooth transitions */
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .difficulty-button:hover {
            box-shadow: 0 0 10px var(--button-glow-color-hover, rgba(173, 216, 230, 0.5)); /* Soft glow on hover, dynamic color */
        }

        .difficulty-button.selected {
            animation: pulse-glow 2s infinite; /* Pulsing glow for selected state */
        }
        
        /* Ensure prose list items and paragraphs inherit text color */
        .prose ul, .prose ol, .prose p {
            color: #d1d5db; /* slate-300 */
        }
        /* Highlight critical information with dynamic color */
        .prose strong { /* Keeping original strong styling for basic bold */
            color: #f0f0f0;
            font-weight: 700;
        }
        .highlight-text { /* New class for semantic highlighting with dynamic color */
            color: var(--highlight-color) !important; /* Force color to be visible */
            transition: color 0.3s ease; /* Smooth transition for color change */
            font-weight: 700 !important; /* Ensure it's bold and overrides any prose default */
        }

        /* --- Collapsible section styling --- */
        .collapsible-section {
            border-radius: 0.75rem; /* rounded-xl for consistency */
            overflow: hidden; /* Hide overflow during collapse/expand */
            margin-bottom: 1rem; /* space-y-4 implies this */
        }

        .collapsible-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem; /* Consistent padding */
            border-bottom-width: 2px; /* border-b-2 */
            background-color: rgba(26, 26, 26, 0.4); /* Darker background for header */
            transition: background-color 0.3s ease, opacity 0.3s ease; /* Smooth header transitions */
            border-color: var(--module-accent-color); /* Dynamic border color */
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
        }

        .collapsible-header.expanded {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .collapsible-header:hover {
            background-color: rgba(26, 26, 26, 0.6);
        }

        .collapsible-header h4 {
            flex-grow: 1; /* Allow h4 to take available space */
            color: #fff; /* text-white */
            font-weight: 600; /* font-semibold */
            font-size: 1.25rem; /* text-xl */
            line-height: 1.75rem; /* leading-7 */
            padding-right: 0.5rem; /* Add some space before the buttons */
        }
        
        /* -- NEW: Collapsible content animation using CSS Grid -- */
        .collapsible-content {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s ease-in-out;
        }
        .collapsible-content.expanded {
            grid-template-rows: 1fr;
        }
        .collapsible-content .inner-content-wrapper {
            overflow: hidden;
            padding: 0 1rem;
            transition: opacity 0.3s ease-in, padding-top 0.4s ease-in-out, padding-bottom 0.4s ease-in-out;
            opacity: 0;
        }
        .collapsible-content.expanded .inner-content-wrapper {
            opacity: 1;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        /* Adjusted styling for content boxes within the new wrapper */
        .collapsible-content .content-box {
            background-color: rgba(0, 0, 0, 0.2); /* bg-black/20 */
            padding: 1rem; /* p-4 */
            border-radius: 0.5rem; /* rounded-lg */
            border: 1px solid rgba(255, 255, 255, 0.1); /* border border-white/10 */
        }
        /* Add margin between multiple content boxes inside the wrapper */
        .inner-content-wrapper .content-box + .content-box {
            margin-top: 0.75rem;
        }

        /* Adjust button group for solution header */
        .solution-header .difficulty-buttons {
            display: flex;
            gap: 0.5rem; /* gap-2 */
            margin-left: 1rem; /* ml-auto to push them right, plus some space */
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Background elements -->
    <div class="background-container is-loading">
        <div class="background-base-sky">
            <div class="sanctum-orb sky-orb base-orb-1"></div>
            <div class="sanctum-orb sky-orb base-orb-3" style="animation-delay: 0s, 10s;"></div>
        </div>
        <div class="background-sanctum">
            <div class="sanctum-orb earth-orb base-orb-2"></div>
        </div>
        <div id="image-orb-container" class="background-image-orb-container">
            <!-- JS will populate these -->
        </div>
    </div>

    <!-- Start of Main Page Container -->
    <div class="container mx-auto max-w-5xl p-4 relative z-10">
        <!-- Header -->
        <header class="text-center my-10 md:my-16">
             <h1 class="text-5xl md:text-7xl font-bold flex items-center justify-center">
                <span class="gradient-text">THE&nbsp;</span>
                <span id="music-toggle" class="gradient-text music-switch">M</span>
                <span class="gradient-text">ANUAL</span>
            </h1>
        </header>

        <!-- Main Application Card -->
        <main class="frosted-glass rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8">
            <div class="mb-6">
                <nav class="flex flex-wrap gap-2 p-2 bg-black/20 rounded-xl" id="tabs-container">
                    <button data-tab="schedule" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-active transition-all duration-300 flex items-center justify-center">训练日程</button>
                    <button data-tab="journal" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300 flex items-center justify-center">日志</button>
                    <button data-tab="module1" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">松解</button>
                    <button data-tab="module2" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">呼吸</button>
                    <button data-tab="module3" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">地基</button>
                    <button data-tab="module4" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">控制</button>
                    <button data-tab="module5" class="tab flex-grow text-sm md:text-base font-medium py-3 px-4 rounded-lg tab-inactive transition-all duration-300">拉伸</button>
                </nav>
            </div>

            <div id="tab-content-container">
                <div id="tab-schedule" class="tab-content">
                    <h3 class="text-xl font-bold text-white mb-4">今日训练任务</h3>
                    <div id="task-list" class="space-y-2"></div>
                </div>
                <div id="tab-journal" class="tab-content hidden">
                    <h3 class="text-xl font-bold text-white mb-4">训练日志</h3>
                    <div class="space-y-4">
                        <textarea id="journal-input" class="w-full h-40 bg-black/20 text-slate-200 p-4 rounded-lg border border-white/10 focus:border-cyan-400 focus:ring-cyan-400/50 focus:bg-black/30 transition-all duration-300" placeholder="记录今天的训练感受、身体反馈、任何值得注意的细节..."></textarea>
                        <div class="flex gap-4">
                            <button id="save-journal-entry" class="flex-1 module-button font-semibold py-3 px-5 rounded-lg text-white flex items-center justify-center gap-2">保存</button>
                            <button id="export-journal-entry" class="flex-1 module-button font-semibold py-3 px-5 rounded-lg text-white flex items-center justify-center gap-2">导出</button>
                        </div>
                        <div id="journal-entries" class="space-y-4 max-h-[50vh] overflow-y-auto pr-2"></div>
                    </div>
                </div>
                <div id="tab-module1" class="tab-content hidden"></div>
                <div id="tab-module2" class="tab-content hidden"></div>
                <div id="tab-module3" class="tab-content hidden"></div>
                <div id="tab-module4" class="tab-content hidden"></div>
                <div id="tab-module5" class="tab-content hidden"></div>
            </div>
        </main>
    </div>
    <!-- End of Main Page Container -->

    <!-- Audio Player -->
    <audio id="background-music" loop>
        <source src="https://github.com/ganmaoling99911/karate-kid/raw/refs/heads/main/ScreenRecording_06-22-2025%2011-36-01_1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Modals (Hidden by default) -->
    <div id="modal-overlay" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div id="modal-container" class="frosted-glass rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-8 opacity-0 transform scale-95 relative">
            <button id="modal-close-button" class="absolute top-4 right-4 text-gray-200 hover:text-white z-10">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div id="modal-content"></div>
        </div>
        
        <div id="journal-edit-modal" class="frosted-glass rounded-2xl w-full max-w-lg p-8 opacity-0 transform scale-95 hidden flex-col gap-4">
            <h3 class="text-xl font-bold text-white">修改日志</h3>
            <textarea id="journal-edit-input" class="w-full h-48 bg-black/20 text-slate-200 p-4 rounded-lg border border-white/10 focus:border-cyan-400 focus:ring-cyan-400/50 transition-all"></textarea>
            <div class="flex gap-4">
                <button id="journal-edit-cancel" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg">取消</button>
                <button id="journal-edit-save" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg bg-cyan-500/20 border-cyan-400 hover:bg-cyan-500/40">保存修改</button>
            </div>
        </div>

        <div id="delete-confirm-modal" class="frosted-glass rounded-2xl w-full max-w-sm p-8 opacity-0 transform scale-95 hidden flex-col gap-4 items-center">
             <h3 class="text-xl font-bold text-white">确认删除?</h3>
             <p class="text-slate-300 text-center">此操作无法撤销.</p>
             <div class="flex gap-4 w-full mt-4">
                <button id="delete-confirm-cancel" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg">取消</button>
                <button id="delete-confirm-button" class="flex-1 module-button font-semibold py-2 px-4 rounded-lg bg-rose-500/20 border-rose-400 hover:bg-rose-500/40">删除</button>
            </div>
        </div>
    </div>

    <script>
        // Exercise data including solution variations for different difficulties
        const exerciseData = {
            'foam-roll': { 
                module: 1, 
                title: '泡沫轴松解 - 关键抑制点', 
                target: '暂时抑制和放松因长期久坐而过度紧张的关键肌肉: 大腿前侧 (股四头肌) 与大腿外侧上方 (阔筋膜张肌 - TFL).', 
                principle: '<p>根据 "<span class="highlight-text">交互抑制</span>" 原则, 当一侧的肌肉过度紧张时, 其功能相反的肌肉就会在神经层面受到抑制. 股四头肌和TFL的过度紧张是抑制您臀肌的主要 "元凶".</p>', 
                benefit: '<p>放松这两块肌肉, 等于为 "<span class="highlight-text">唤醒</span>" 臀部主力军创造绝佳的神经环境, 从而改善训练质量, 减少髋部和膝部的代偿与疼痛.</p>', 
                guide: `<ol><li class="mb-2"><strong>a. 松解股四头肌 (大腿前侧):</strong><ol class="list-decimal list-inside ml-4 text-gray-300"><li>将泡沫轴横放在垫上, 以前臂支撑身体, 呈俯卧姿势, 将一侧大腿的前侧置于泡沫轴上. 另一条腿屈膝向侧方打开, 用以支撑和控制身体.</li><li>保持核心收紧, 避免腰部塌陷.</li></li><li>用手臂和支撑腿的力量, 驱动身体前后缓慢移动, 让泡沫轴在您的大腿前侧 (从髋关节下方到膝盖上方) 来回滚动.</li><li>当找到一个特别酸痛的 <span class="highlight-text">激痛点</span> 时, 停止滚动, 保持在该点上, 进行3-4次深长而缓慢的呼吸 (约15-20秒).</li></ol></li><li><strong>b. 松解阔筋膜张肌 (TFL) / 大腿外侧最上方:</strong><ol class="list-decimal list-inside ml-4 text-gray-300"><li>身体侧卧, 将泡沫轴置于您大腿外侧的<span class="highlight-text">最上方</span>, 大致在您裤子口袋的区域.</li><li>下方的手肘支撑在地上, 上方的腿可以弯曲踩在身前或身后以帮助稳定和控制压力.</li><li>在这个<span class="highlight-text">很小的区域内</span> (就在您髋部侧方骨头的正下方), 进行小范围的, 缓慢的前后或左右滚动. <span class="highlight-text">不要向下滚动到大腿中段 (髂胫束)</span>.</li><li>TFL通常非常敏感, 请务务必缓慢并配合深呼吸.</li></ol></li></ol>`, 
                errorWhy: `<p><span class="highlight-text">滚动速度过快:</span> 大脑想快速逃离不适感, 但这无法给神经系统足够的时间去处理信号并让肌肉放松.</p><p><span class="highlight-text">憋气:</span> 身体应对疼痛的本能反应, 但这会激活交感神经, 让肌肉更加紧张, 适得其反.</p><p><span class="highlight-text">核心松懈, 腰部塌陷:</span> 注意力过于集中在局部, 缺乏整体控制意识.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案 (针对疼痛):</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">降压:</span> 通过手臂和支撑腿更多地分担体重，来减轻泡沫轴的压力。</li><li><span class="highlight-text">"农村包围城市" 策略:</span> 如果某个点过于疼痛，先在它周围不那么痛的区域进行放松，等周边肌肉放松后，再逐渐向核心痛点靠近。</li><li><span class="highlight-text">变滚动为按压:</span> 对于特别敏感的区域 (如TFL)，放弃滚动，改为静态按压。找到最痛的点，保持在上面，只做深呼吸，持续20-30秒，直到感觉紧张感明显缓解。</li></ul></p>`,
                    现有: `<p><span class="highlight-text">强制自己以 "蜗牛" 般的速度移动</span> (想象每秒移动一厘米). 在找到的痛点上, 进行<span class="highlight-text">仪式化呼吸</span>: 用鼻子深吸4秒, 然后噘起嘴唇, 用6-8秒的时间缓慢地, 有控制地呼出气体, 感受肌肉在呼气时 "融化" 在泡沫轴上.</p><p>在开始滚动前, 先主动收紧腹部, 想象有人要轻轻地戳你的肚子, 你要有力量地 "<span class="highlight-text">顶住</span>". 在整个滚动过程中, 都要保持这个 "<span class="highlight-text">核心护甲</span>".</p><p><strong>您的个性化工具箱 (针对疼痛):</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">降压:</span> 通过手臂和支撑腿更多地分担体重, 来减轻泡沫轴的压力.</li><li><span class="highlight-text">"农村包围城市" 策略:</span> 如果某个点过于疼痛, 先在它周围不那么痛的区域进行放松, 等周边肌肉放松后, 再逐渐向核心痛点靠近.</li></li><li><span class="highlight-text">变滚动为按压:</span> 对于特别敏感的区域 (如TFL), 放弃滚动, 改为静态按压. 找到最痛的点, 保持在上面, 只做深呼吸, 持续20-30秒, 直到感觉紧张感明显缓解.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">增加压力:</span> 如果您觉得现有压力不足，可以尝试将更多体重压在泡沫轴上，减少手和支撑腿的辅助。</li><li><span class="highlight-text">小范围深层滚动:</span> 在不适感可控的前提下，针对激痛点进行更小范围、更慢速、更深层的滚动，尝试“解开”深层筋膜粘连。</li><li><span class="highlight-text">结合动态拉伸:</span> 在按压激痛点时，尝试小幅度地屈伸膝盖或摆动腿部，增加对肌肉纤维的拉伸和松解效果。</li></ul></p>`
                }
            },
            'breathing': { 
                module: 2, 
                title: '90/90髋关节抬高伴球囊呼吸', 
                target: '利用呼吸重置骨盆和胸廓的位置, 建立一个力学上最优的 "<span class="highlight-text">核心中立位</span>", 为所有后续动作打下坚实基础.', 
                principle: '<p><span class="highlight-text">不良姿势的核心是骨盆和胸廓的位置错误</span>. 此动作通过腘绳肌的发力将前倾的骨盆 "<span class="highlight-text">卷</span>>" 回中立位, 通过呼气时腹肌的收缩将外翻的肋骨 "<span class="highlight-text">拉回</span>>" 原位, 从而重建核心的稳定序列.</p>', 
                benefit: '<p><span class="highlight-text">直接解决体态问题的最底层根源</span>, 重建膈肌的正常功能, 让你学会用核心而非颈肩来呼吸和稳定. 一个中立, 稳定的核心, 是所有肢体正确运动的支撑平台.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li><span class="highlight-text">准备姿势:</span> 仰卧, 双脚脚跟踩在墙上, 使膝盖和髋关节都呈90度. 双膝之间夹一个软球或枕头.</li><li><span class="highlight-text">启动:</span> 轻轻用脚后跟向下 "<span class="highlight-text">拽</span>>" 墙, 您会感觉到大腿后侧 (腘绳肌) 有轻微的紧张感. 利用这个力量, 将您的尾骨 (臀部) 抬离地面一英寸, 直到您的下背部平贴地面.</li><li><span class="highlight-text">呼吸序列:</span><ol class="list-decimal list-inside ml-4"><li>用鼻子缓慢, 安静地吸气, 感觉气息充满您的胸腔和腹部.</li><li>用嘴巴缓慢, 悠长地呼气, 仿佛在吹一个气球. 在呼气的最后, 您应该感觉到腹部肌肉收紧, 肋骨向内, 向下沉.</li><li><span class="highlight-text">保持住!</span> 在不吸气的情况下, 暂停2-3秒, 维持腹肌收紧的感觉.</li><li>保持腹肌的收紧感, 再次用鼻子吸气, 重复整个过程.</li></ol></li><li><span class="highlight-text">要点:</span> 全程保持大腿后侧的轻微紧张感和下背部平贴地面.</li></ol>`, 
                errorWhy: `<p>用<span class="highlight-text">腰发力抬臀:</span> 您的身体习惯于用已经过度活跃的竖脊肌去代偿无力的臀肌和蘹绳肌, 这是您旧有错误模式的直接体现.</p><p><span class="highlight-text">过度抬高臀部:</span> 这是追求动作幅度而非质量的常见误区. 这个动作的核心是实现 "<span class="highlight-text">骨盆后倾</span>", 而非 "抬高臀部".</p><p><span class="highlight-text">吸气时失控:</span> 核心肌群的耐力不足, 无法在膈肌下降产生腹压时, 维持住肋骨和骨盆来之不易的中立位.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">蘹绳肌激活困难?</span> 在开始前, 先只做 "<span class="highlight-text">用脚后跟向下拖拽墙壁</span>>" 的动作, 反复5-10次, 直到您能清晰地感觉到大腿后侧的紧张感。</li><li><span class="highlight-text">球囊感觉太难?</span> 放弃球囊，只是噘起嘴唇，像通过一根很细的吸管一样，缓慢地，有阻力地呼气。把注意力完全放在感受腹部收紧和肋骨下沉上。</li></ul></p>`,
                    现有: `<p><span class="highlight-text">触觉反馈法 (针对腰部代偿):</span> 将一只手放在下背部的空隙处, 另一只手放在大腿后侧 (蘹绳肌). 正确的动作是, 当下背部的手感觉到背部压实地面时, 大腿后侧的手能摸到肌肉正在收紧. 如果下背部变得更紧张, 说明错了.</p><p><span class="highlight-text">幅度控制 (针对过度抬高):</span> 忘掉 "<span class="highlight-text">抬高</span>>" 这个词, 换成 "<span class="highlight-text">滚动</span>>". 想象您的骨盆是一个碗, 您只是想把碗边向您的脸的方向滚动一点点, 让您的尾骨轻轻抬离地面一英寸. 幅度不重要, 骨盆后倾的感觉最重要.</p><p><span class="highlight-text">呼吸控制 (针对吸气失控):</span> 在吸气时, 将您的双手放在身体两侧的下肋廓上. 您的目标是感觉到肋骨向两侧 "<span class="highlight-text">推开</span>>" 您的手, 而不是向上或向前. 吸气要慢, 要轻柔, 只吸到七八分满即可.</p><p><strong>您的个性化工具箱:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">蘹绳肌激活困难?</span> 在开始前, 先只做 "用脚后跟向下拖拽墙壁" 的动作, 反复5-10次, 直到您能清晰地感觉到大腿后侧的紧张感.</li><li><span class="highlight-text">球囊感觉太难?</span> 退阶练习. 放弃球囊, 只是噘起嘴唇, 像通过一根很细的吸管一样, 缓慢地, 有阻力地呼气. 把注意力完全放在感受腹部收紧和肋骨下沉上.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">增加阻力:</span> 在膝盖之间使用一条弹力带，向内夹紧，增加髋内收肌的参与和核心挑战。</li><li><span class="highlight-text">计时保持:</span> 在顶峰位置（骨盆后倾，下背部贴地）增加保持时间，例如保持5-10秒，强化核心耐力。</li><li><span class="highlight-text">呼吸节奏挑战:</span> 尝试更快的吸气和更长的呼气，或者在呼气末尾暂停更长时间，进一步提升呼吸控制和核心稳定性。</li></ul></p>`
                }
            },
            'tripod-foot': { 
                module: 3, 
                title: '足部三点支撑与抓地训练', 
                target: '学习有意识地建立一个稳定的足部 "<span class="highlight-text">三脚架</span>" 支撑, 并激活维持足弓的内在肌群.', 
                principle: '<p>我们先主动"<span class="highlight-text">设定</span>"一个稳定的足部结构, 然后再通过"<span class="highlight-text">等长收缩</span>" (抓地) 来强化它. 这是一种更直接, 更具象的神经连接训练.</p>', 
                benefit: '<p>这是一个 "<span class="highlight-text">地基工程</span>>". 稳定的 "<span class="highlight-text">三脚架</span>>" 足底能确保力量均匀上传, 防止足踝向内塌陷 (膝盖内扣的起始环节). 学会主动 "<span class="highlight-text">抓地</span>>", 等于给足弓装上 "<span class="highlight-text">主动稳定系统</span>>".</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>舒适地坐在椅子上, 双脚平放于地面, 膝盖呈90度.</li><li>主动找到并感知您足底的<span class="highlight-text">三个核心支撑点</span>: 大脚趾根部, 小脚趾根部, 以及脚后跟的中心.</li><li>有意识地将这三个点均匀地压向地面.</li><li><span class="highlight-text">核心步骤:</span> 在保持这三点紧压地面的前提下, 想象用整个脚底去 "<span class="highlight-text">吸住</span>>" 或 "<span class="highlight-text">抓住</span>>" 地面, 但<span class="highlight-text">脚趾保持放松伸展, 绝不弯曲</span>.</li><li>您会感觉到足弓有轻微的向上隆起和收紧感. 保持这个<span class="highlight-text">等长收缩</span>5-10秒.</li><li>缓慢地完全放松, 重复进行.</li></ol>`, 
                errorWhy: `<p><span class="highlight-text">弯曲脚趾来 "抓地":</span> 这是最常见的代偿, 因为控制脚趾弯曲的肌肉 (足外在肌) 更强大, 更容易被调用, 而我们想训练的是深层的足底内在肌.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">分离控制训练:</span> 如果总是忍不住用脚趾, 先做这个练习来分离控制: 保持三点支撑, 只练习轻轻地将所有脚趾向上抬起 (脚掌不动), 再轻轻放下. 这能教会您的大脑 "脚趾" 和 "足弓" 是两回事.</li><li><span class="highlight-text">强度控制:</span> 如果出现抽筋，说明发力过猛。放松，甩甩脚，然后只用10-20%的力气去尝试。</li></ul></p>`,
                    现有: `<p><span class="highlight-text">眼睛始终盯着脚趾</span>, 确保它们放松伸展. 将意念从 "<span class="highlight-text">抓</span>>" 改为 "<span class="highlight-text">用脚心吸起一张纸</span>>" 或 "<span class="highlight-text">让足弓像吸盘一样吸住地面</span>>".</p><p>用您的手指放在足弓下方, 当您正确发力时, 您应该能感觉到足弓<span class="highlight-text">向上顶您的手指</span>, 而脚趾并没有动.</p><p><strong>您的个性化工具箱 (退阶训练):</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">分离控制训练:</span> 如果总是忍不住用脚趾, 先做这个练习来分离控制: 将所有脚趾向上抬起 (脚掌不动), 然后只练习轻轻地放下大脚趾，再放下其他脚趾。或者只抬起大脚趾，再放下。</li><li><span class="highlight-text">带入生活:</span> 尝试在排队或站立时, 有意识地建立足底三点支撑的感觉, 让它成为一种习惯.</li><li><span class="highlight-text">强度控制:</span> 如果出现抽筋, 说明发力过猛. 放松, 甩甩脚, 然后只用10-20%的力气去尝试.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">单腿站立抓地:</span> 在保持足部三点支撑的基础上，尝试单腿站立，挑战足部稳定肌群在更高负荷下的工作能力。</li><li><span class="highlight-text">动态抓地:</span> 在行走或进行其他动作时，有意识地维持足部三点支撑和抓地感。</li><li><span class="highlight-text">负重抓地:</span> 在进行如深蹲、硬拉等训练时，将足部抓地融入动作模式中。</li></ul></p>`
                }
            },
            'ankle-stability': { 
                module: 3, 
                title: '单脚稳定与重心转移训练', 
                target: '在一个安全, 可控的环境中, 唤醒并训练负责踝关节左右稳定性的<span class="highlight-text">深层肌肉</span>.', 
                principle: '<p>我们采用 "<span class="highlight-text">有辅助的单脚站立</span>>", 消除平衡难题, 让您可以将全部注意力集中在脚踝上. 当进行微小重心转移时, 负责防止脚踝内外翻的肌肉 (腓骨长短肌, 胫后肌) 必须进行<span class="highlight-text">快速, 精细的收缩</span>来维持稳定.</p>', 
                benefit: '<p>这是对 "足部三点支撑" 的直接升级. 它教会您的踝关节如何在<span class="highlight-text">动态扰动中保持中立</span>, 是预防崴脚, 为未来跑跳建立安全基础的关键一环.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>赤脚站立, 旁边放一把椅子或靠近墙壁, 以便<span class="highlight-text">随时用手轻轻扶住</span>.</li><li>先在双脚站立时, 完成 "足部三点支撑与抓地" 练习.</li><li>将重心缓慢转移到一侧腿上, 另一脚轻轻抬离地面, <span class="highlight-text">手上始终保持轻扶</span>.</li><li><span class="highlight-text">第一阶段 (静态保持):</span> 保持姿势, 注意力放在支撑脚的脚踝上. 目标是让脚踝尽可能稳定. 保持15-30秒.</li><li><span class="highlight-text">第二阶段 (动态挑战):</span> 在能稳定保持后, 尝试进行极其微小的, 有控制的重心转移 (前, 后, 左, 右).</li></ol>`, 
                errorWhy: `<p><span class="highlight-text">脚踝剧烈晃动:</span> 踝关节的深层稳定肌群力量和神经控制能力不足, 这恰好是我们要训练它的原因.</p><p><span class="highlight-text">用手死死抓住支撑物:</span> 缺乏安全感, 但这样重量没有完全给到脚踝, 失去了训练意义.</p><p><span class="highlight-text">注意力分散:</span> 大脑倾向于关注宏观平衡, 而非局部的肌肉控制.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">"脚尖点地" 辅助:</span> 如果静态保持都非常困难, 这是最佳的退阶选择. 将抬起的那只脚的脚尖轻轻点在支撑脚的旁边地面上, 这能分担一小部分重量, 极大地降低难度.</li><li><span class="highlight-text">疼痛处理:</span> 如果脚踝的任何位置出现尖锐疼痛, 立即停止。首先检查您的 "足部三点支撑" 是否依然有效。如果疼痛持续，说明此动作对您来说为时过早，应专注于 "足部三点支撑" 和 "靠墙静蹲"。</li></ul></p>`,
                    现有: `<p>接受初期的<span class="highlight-text">轻微晃动</span>, 这是肌肉在学习. 不要与之对抗, 而是尝试去<span class="highlight-text">控制</span>它, 让晃动变得更慢, 幅度更小.</p><p>遵循<span class="highlight-text">"钢琴手" 原则</span>--想象您的手是在弹钢琴, 只是用指尖轻轻搭在支撑物上, 提供一个安全备份, 而不是用它来承重. 您的目标是逐渐减少对辅助的依赖.</p><p>将您的目光和意念都<span class="highlight-text">锁定在支撑脚的脚踝上</span>. 同时, 在前方墙壁上找一个固定的点进行注视, 这能极大地帮助您稳定.</p><p><strong>您的个性化工具箱 (退阶与进阶):</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">退阶: "脚尖点地" 辅助:</span> 如果静态保持都非常困难, 这是最佳的退阶选择. 将抬起的那只脚的脚尖轻轻点在支撑脚的旁边地面上, 这能分担一小部分重量, 极大地降低难度.</li><li><span class="highlight-text">进阶: 闭眼挑战.</span> 在能轻松完成动态挑战后, 尝试闭上眼睛进行静态保持 (务必确保旁边有可靠支撑物), 这会完全剥夺您的视觉输入, 迫使踝关节的本体感觉系统加倍工作.</li><li><span class="highlight-text">疼痛处理:</span> 如果脚踝的任何位置出现尖锐疼痛, 立即停止. 首先检查您的 "足部三点支撑" 是否依然有效. 如果疼痛持续, 说明此动作对您来说为时过早, 应专注于 "足部三点支撑" 和 "靠墙静蹲".</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">不扶墙单腿站立:</span> 逐渐减少甚至完全移除手部辅助，挑战自身平衡能力。</li><li><span class="highlight-text">软垫站立:</span> 在瑜伽垫或平衡垫等不稳定的表面上进行单腿站立，进一步挑战踝关节的稳定性。</li></li><li><span class="highlight-text">投掷/接球干扰:</span> 在单腿站立时，进行简单的投掷或接球动作，增加对身体平衡系统的干扰，提高动作的复杂性。</li></ul></p>`
                }
            },
            'wall-sit': { 
                module: 3, 
                title: '靠墙静蹲', 
                target: '在一个对膝关节<span class="highlight-text">绝对安全</span>的闭链环境中, 通过等长收缩强化股四头肌和臀肌的力量, 提升膝关节的稳定性.', 
                principle: '<p>"<span class="highlight-text">靠墙静蹲</span>" 是经典的等长收缩训练. 背部和髋部被墙壁支撑, 膝关节不会承受剪切力和摩擦. 这让我们能在<span class="highlight-text">零风险</span>情况下, 让稳定膝关节的肌肉长时间, 高强度地工作.</p>', 
                benefit: '<p>这是直接针对您膝盖疼痛和不稳问题的<span class="highlight-text">安全高效方案</span>. 强化股四头肌, 等于给膝盖骨安装了强大的 "<span class="highlight-text">稳定器</span>>".</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>背靠墙壁站立, 双脚分开与髋同宽, 脚尖朝前, 脚掌距离墙壁约一到两脚的距离.</li><li>保持背部紧贴墙面, 核心收紧, 身体沿墙壁缓慢向下滑动, 直到您的大腿与地面平行 (或在您感到舒适, <span class="highlight-text">无痛的最高角度</span>).</li><li>检查姿势: 膝盖应位于脚踝的<span class="highlight-text">正上方</span>, 小腿与地面垂直.</li><li>将重心均匀分布在<span class="highlight-text">整个脚掌</span>上, 感觉大腿前侧和臀部肌肉正在持续发力.</li><li>保持姿势, 平稳呼吸, 持续30-60秒, 或直到无法维持标准姿势为止.</li><li>完成后, 用手支撑墙壁, 缓慢地将身体推回站立姿势.</li></ol>`, 
                errorWhy: `<p><span class="highlight-text">膝盖内扣:</span> 臀中肌无力的直接体现, 身体在重复这个错误的力学模式.</p><p><span class="highlight-text">膝盖疼痛:</span> 下蹲角度过大, 超出了当前关节的承受能力, 或是力线不正.</p><p><span class="highlight-text">用脚尖发力过多:</span> 这会过多激活股四头肌, 减少臀肌的参与, 并且增加对膝关节的压力.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">消除疼痛 (绝对优先):</span> 立即减小下蹲的深度。您的目标是找到一个<span class="highlight-text">完全无痛的角度</span>。哪怕只下蹲几厘米，只要能感觉到大腿发力且膝盖无痛，就是正确的。质量永远比幅度重要。</li><li><span class="highlight-text">时间换强度:</span> 如果即使在很高的角度也无法保持30秒，那就改为保持15秒，但增加组数。</li></ul></p>`,
                    现有: `<p><span class="highlight-text">纠正膝内扣:</span> 在开始前, 主动想象要 "<span class="highlight-text">将地面向两侧撕裂</span>>", 这能预激活您的臀部外旋肌. 如果问题依然存在, 可以在两膝之间夹一个枕头并向内夹紧, 或者在膝盖外侧套上弹力带并主动向外撑开.</p><p><span class="highlight-text">消除疼痛 (绝对优先):</span> 立即减小下蹲的深度. 您的目标是找到一个<span class="highlight-text">完全无痛的角度</span>. 哪怕只下蹲几厘米, 只要能感觉到大腿发力且膝盖无痛, 就是正确的. 质量永远比幅度重要.</p><p><span class="highlight-text">调整重心:</span> 确保重心在<span class="highlight-text">足中部</span>. 有意识地用<span class="highlight-text">脚后跟</span>向下发力, 想象要把鞋子踩穿. 您甚至可以尝试稍微抬起脚趾, 以确保重心在后方.</p><p><strong>您的个性化工具箱:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">核心参与:</span> 在下蹲前, 轻轻收腹, 想象下背部有一个徽章, 您需要把它平整地印在墙上, 整个过程都不要让它拱起.</li><li><span class="highlight-text">非对称调整:</span> 如果只有一侧膝盖不适, 可以尝试将感觉不适的那一侧脚稍微向前移动一点点 (约半个脚掌距离).</li></li><li><span class="highlight-text">时间换强度:</span> 如果即使在很高的角度也无法保持30秒, 那就改为保持15秒, 但增加组数.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">增加时长:</span> 逐渐增加每次静蹲的保持时间，例如从60秒延长到90秒甚至更长。</li><li><span class="highlight-text">负重静蹲:</span> 可以在大腿上放置哑铃或杠铃片，增加负重，提升强度。</li><li><span class="highlight-text">单腿静蹲:</span> 尝试单腿靠墙静蹲，这会极大地挑战单侧腿的力量和膝关节稳定性。</li></ul></p>`
                }
            },
            'glute-bridge': { 
                module: 4, 
                title: '臀桥', 
                target: '唤醒并强化<span class="highlight-text">臀大肌</span>, 重建正确的伸髋模式.', 
                principle: '<p><span class="highlight-text">臀大肌是人体最有力的伸髋肌群</span>. 在您的案例中, 它处于 "<span class="highlight-text">沉睡</span>>" 状态, 导致伸髋的任务被腰部和蘹绳肌代偿. 臀桥是唤醒它的<span class="highlight-text">最直接方式</span>.</p>', 
                benefit: '<p>一个<span class="highlight-text">强有力的臀部</span>能稳定骨盆, 直接减轻膝关节和腰椎的压力.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>仰卧, 屈膝, 双脚与髋同宽平放于地, 脚尖朝前.</li><li>首先做一个<span class="highlight-text">轻微的骨盆后倾</span>, 将下背部压向地面.</li><li>保持骨盆后倾, 以 "<span class="highlight-text">用脚后跟蹬地, 将臀部推向天花板</span>>" 为意念启动动作.</li><li>在顶峰时, 应感觉<span class="highlight-text">臀部肌肉强烈收缩</span>, 而下背部和蘹绳肌没有明显发力感.</li><li>缓慢下放, 重复进行.</li></ol>`, 
                errorWhy: `<p><span class="highlight-text">用腰代偿:</span> 身体默认使用最强的肌肉 (下背部) 完成任务.</p><p><span class="highlight-text">蘹绳肌抽筋:</span> 它试图帮助无力的臀肌, 导致负荷过大.</p><p><span class="highlight-text">左髋前侧疼痛:</span> 伸髋末端可能存在关节撞击或软组织挤压.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">等长臀桥:</span> 这是您目前最安全的版本。完成 "<span class="highlight-text">两步启动法</span>>" 中的第一步 (骨盆后倾)，然后想象要向上抬起，全力收紧臀部肌肉，但<span class="highlight-text">臀部保持不离开地面</span>。目标是只感受臀部强烈的收缩感，而髋关节不产生任何运动。保持收缩5-10秒，然后放松。</li><li><span class="highlight-text">应对左髋疼痛 (最高优先级):</span> 这是<span class="highlight-text">绝对的停止信号</span>。您需要立刻<span class="highlight-text">放弃所有抬起的动作</span>，执行上面的退阶版本。</li></ul></p>`,
                    现有: `<p>"<span class="highlight-text">两步启动法</span>": 这是解决腰部代偿的<span class="highlight-text">关键</span>. <span class="highlight-text">第一步 (倾斜):</span> 呼气, 收紧腹部, 将下背部完全压向地面 (完成骨盆后倾). 保持住. <span class="highlight-text">第二步 (挤压抬起):</span> 保持骨盆后倾的状态, 然后专注于 "用臀部肌肉发力去夹紧", 让这个夹紧的力量把您的臀部向上推起.</p><p><span class="highlight-text">解决蘹绳肌抽筋:</span> 除了将脚后跟向臀部靠近, 还可以在抬起前, 先主动, 有意识地挤压臀部肌肉, 感受它变硬, 然后再用脚后跟发力. 确保臀部是<span class="highlight-text">第一个 "开工" 的</span>.</p><p><span class="highlight-text">应对左髋疼痛 (最高优先级):</span> 这是<span class="highlight-text">绝对的停止信号</span>. 您需要立刻<span class="highlight-text">放弃所有抬起的动作</span>, 执行下面的退阶版本.</p><p><strong>您的个性化工具箱 (退阶训练):</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">等长臀桥:</span> 这是您目前最安全的版本. 完成 "<span class="highlight-text">两步启动法</span>>" 中的第一步 (骨盆后倾), 然后想象要向上抬起, 全力收紧臀部肌肉, 但<span class="highlight-text">臀部保持不离开地面</span>. 目标是只感受臀部强烈的收缩感, 而髋关节不产生任何运动. 保持收缩5-10秒, 然后放松.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">单腿臀桥:</span> 挑战更高难度的单侧臀肌力量和骨盆稳定性。</li><li><span class="highlight-text">弹力带臀桥:</span> 在膝盖上方套上弹力带，向外撑开，增加臀中肌的参与。</li><li><span class="highlight-text">负重臀桥:</span> 在髋部放置哑铃或杠铃片，增加负重。</li></li></ul></p>`
                }
            },
            'clamshell': { 
                module: 4, 
                title: '蚌式开合', 
                target: '<span class="highlight-text">精准激活臀中肌</span>, 学习髋外旋控制.', 
                principle: '<p>此动作<span class="highlight-text">精准激活臀中肌</span>, 它是稳定骨盆侧方的<span class="highlight-text">关键</span>. 其无力是您膝盖内扣的直接原因.</p>', 
                benefit: '<p>强化臀中肌, 就是<span class="highlight-text">直接修复导致您膝痛的错误力学模式</span>.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>身体侧卧, 双腿屈膝交叠, 脚后跟, 臀部, 上背部大致在一条直线上.</li><li>保持<span class="highlight-text">骨盆绝对静止</span> (想象骨盆上下两点被钉在一起) 和双脚并拢的情况下, 缓慢地将上方的膝盖抬起.</li><li>在顶端感受<span class="highlight-text">臀部侧后方肌肉的酸胀感</span>, 稍作停留后缓慢下放.</li></ol>`, 
                errorWhy: `<p><span class="highlight-text">骨盆随膝盖一起向后翻倒:</span> 用整个躯干的转动来 "<span class="highlight-text">作弊</span>>", 以弥补髋关节外旋能力的不足.</p><p><span class="highlight-text">感觉大腿前侧或外侧酸胀:</span> 阔筋膜张肌 (TFL) 在代偿, 它是臀中肌的 "<span class="highlight-text">假朋友</span>>", 总爱抢着干活.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">靠墙练习:</span> 这是最好的纠错工具. 将您的背部和臀部完全紧贴墙壁进行练习, 墙壁会提供一个物理屏障, <span class="highlight-text">绝对不允许您的骨盆向后滚动</span>. 在这个姿态下, 即使幅度很小, 也能确保是目标肌肉在发力.</li><li><span class="highlight-text">小幅度练习:</span> 即使不靠墙，也可以将动作幅度减小到只有原来的1/3甚至更小，只做你能完全控制的范围。</li></ul></p>`,
                    现有: `<p><span class="highlight-text">动作纯净度检查:</span> 将您的上手放在髋骨上, 它就是你的 "<span class="highlight-text">裁判</span>>", 在整个动作中纹丝不动. 同时, 将动作幅度<span class="highlight-text">减小到只有原来的1/3</span>, 甚至更小. 这个动作的精髓在于精准, 而非幅度.</p><p><span class="highlight-text">抑制TFL代偿:</span> 在开始前, 找到您的TFL (裤子前口袋区域的肌肉), 用手指轻轻按摩30秒, 告诉它 "<span class="highlight-text">你可以休息了</span>>". 然后, 将意念从 "抬起膝盖" 改为 "<span class="highlight-text">用臀部侧后方的肌肉, 像旋转钥匙一样, 把大腿骨向外转动</span>>".</p><p><strong>您的个性化工具箱 (终极退阶):</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">靠墙练习:</span> 这是最好的纠错工具. 将您的背部和臀部完全紧贴墙壁进行练习, 墙壁会提供一个物理屏障, <span class="highlight-text">绝对不允许您的骨盆向后滚动</span>. 在这个姿态下, 即使幅度很小, 也能确保是目标肌肉在发力.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">弹力带蚌式:</span> 在膝盖上方套上弹力带，增加开合的阻力，更强烈地激活臀中肌。</li><li><span class="highlight-text">侧卧髋外旋:</span> 保持腿部伸直，只做髋关节的外旋，进一步孤立训练髋外旋肌群。</li><li><span class="highlight-text">站姿蚌式:</span> 扶墙进行单腿站立，然后抬起非支撑腿，向侧上方外展，模拟站立位下的臀中肌激活。</li></ul></p>`
                }
            },
            'scapular-pushup': { 
                module: 4, 
                title: '四点支撑肩胛骨推移', 
                target: '在安全的位置下, 重新建立大脑与肩胛稳定肌 (尤其是<span class="highlight-text">前锯肌</span>) 的神经连接, 并温和地提升胸椎活动度.', 
                principle: '<p>我们不是在等脊柱变直, 而是在您当前的身体条件下, 通过主动的肩胛骨运动来 "<span class="highlight-text">唤醒</span>>" 沉睡的<span class="highlight-text">前锯肌</span>. 这个动作能打破 "<span class="highlight-text">胸椎僵硬-肩胛不稳-稳定肌无力</span>>" 的恶性循环.</p>', 
                benefit: '<p>它能精准地, 孤立地训练肩胛骨在胸廓上的滑动能力, 这是对抗<span class="highlight-text">翼状肩胛</span>, 改善肩颈紧张的<span class="highlight-text">第一步</span>. 同时, 这个前后滑动的过程本身, 就是一个安全, 有效的胸椎动态活动度练习, 两者相辅相成.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>采取四点跪姿, 双手位于肩膀正下方, 膝盖位于髋部正下方, 保持背部中立.</li><li><span class="highlight-text">核心要点:</span> 在整个过程中, <span class="highlight-text">保持您的肘关节完全伸直</span>, 核心收紧, 避免腰部下塌或拱起.</li><li><span class="highlight-text">第一步 (后缩/下沉):</span> 缓慢地让您的胸骨向地面下沉, 想象将两块肩胛骨向脊柱方向相互挤压. 您会感觉到上背部的肌肉被 "<span class="highlight-text">夹</span>>" 在一起.</li><li><span class="highlight-text">第二步 (前伸/上推):</span> 然后, 用力推地, 将您的上背部尽可能地向上拱起, 推向天花板, 想象让两块肩胛骨相互远离, 并包裹住胸廓的两侧. 这个 "<span class="highlight-text">上推</span>>" 的动作是激活前锯肌的<span class="highlight-text">关键</span>.</li><li>动作幅度可能很小, 关键在于感受肩胛骨的滑动, 而非手臂或腰部的运动.</li></ol>`, 
                errorWhy: `<p><span class="highlight-text">弯曲手肘:</span> 这是最常见的代偿, 用手臂的力量代替了肩胛的运动.</p><p><span class="highlight-text">腰部晃动或拱起/下塌:</span> 核心没有保持稳定, 动作变成了全身的晃动.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">手腕疼痛?</span> 这是常见的初期问题。退阶方案是: 将双手握拳，用拳面支撑; 或者将手掌放在瑜伽砖或厚书上，以减少手腕的背伸角度。</li><li><span class="highlight-text">小幅度练习:</span> 如果难以控制，就只做非常非常小的滑动，直到能清晰地感觉到是肩胛骨在动，而不是其他任何地方。</li></ul></p>`,
                    现有: `<p><span class="highlight-text">锁定手肘技巧:</span> 在动作开始前, 有意识地将肘关节 "<span class="highlight-text">锁死</span>>", 并可以尝试稍微向外旋转您的手掌, 让手指尖朝向外侧一点, 这有助于 "<span class="highlight-text">旋紧</span>>" 您的肩关节, 让手肘更难弯曲.</p><p><span class="highlight-text">核心稳定优先:</span> 将注意力放在保持腹部收紧上, 想象从头到尾骨是一条平直的, 不会动的木板. 如果需要, 将水杯或手机放在下背部作为反馈.</p><p><strong>您的个性化工具箱:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">避免耸肩:</span> 在整个动作中, 有意识地让肩膀下沉, 远离耳朵, 想象脖子在变长.</li><li><span class="highlight-text">感受优先:</span> 如果难以控制, 就只做非常非常小的滑动, 直到能清晰地感觉到是肩胛骨在动, 而不是其他任何地方.</li><li><span class="highlight-text">手腕疼痛?</span> 这是常见的初期问题. 退阶方案是: 将双手握拳, 用拳面支撑; 或者将手掌放在瑜伽砖或厚书上, 以减少手腕的背伸角度.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">增加支撑距离:</span> 逐渐将手向身体前方移动，增加动作的杠杆，提高难度。</li><li><span class="highlight-text">俯卧撑姿态肩胛推移:</span> 在俯卧撑的起始姿态下进行肩胛骨推移，挑战核心在更不稳定情况下的稳定性。</li></li><li><span class="highlight-text">单臂肩胛推移:</span> 在四点跪姿或俯卧撑姿态下，尝试单臂进行肩胛骨推移，这会极大地增加对核心和肩胛稳定肌的挑战。</li></ul></p>`
                }
            },
            'bird-dog': { 
                module: 4, 
                title: '鸟狗式', 
                target: '训练核心在面对肢体运动时 "<span class="highlight-text">抵抗旋转</span>>" 和 "<span class="highlight-text">抵抗伸展</span>>" 的能力.', 
                principle: '<p>核心肌群必须以<span class="highlight-text">等长收缩</span>的方式全力工作, 以防止脊柱弯曲或旋转, 为所有四肢运动提供坚如磐石的<span class="highlight-text">中心平台</span>.</p>', 
                benefit: '<p><span class="highlight-text">保护腰椎</span>, 为所有未来的复合运动建立稳定的基础.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>从四点跪姿开始, 双手在肩正下方, 膝盖在髋正下方.</li><li>收紧核心, 想象背上放着<span class="highlight-text">一杯水</span>.</li><li>缓慢地将右手臂向前伸直, 同时将左腿向后伸直, 直到手臂, 躯干和腿形成<span class="highlight-text">一条直线</span>.</li><li>保持这个姿势2-3秒, 感受核心的<span class="highlight-text">稳定</span>.</li><li>缓慢地回到起始位置, 然后换边重复.</li></ol>`, 
                errorWhy: `<p><span class="highlight-text">腰部下塌, 骨盆晃动:</span> 核心肌群没有能成功地 "<span class="highlight-text">锁定</span>>" 脊柱和骨盆, 无法抵抗肢体运动产生的扰动力矩.</p><p><span class="highlight-text">追求高度而非长度:</span> 这是一个误区, 这个动作的目标是训练 "<span class="highlight-text">在伸展中保持稳定</span>>", 而不是柔韧性.</p>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-decimal list-inside mt-1"><li><span class="highlight-text">第一级 (最低难度):</span> 只在地面上向后滑动一条腿, 脚尖不离地.</li><li><span class="highlight-text">第二级:</span> 只在地面上向前滑动一只手臂.</li><li><span class="highlight-text">第三级:</span> 将一条腿抬离地面几厘米, 保持.</li><li><span class="highlight-text">第四级:</span> 将一只手臂抬至与躯干平行, 保持.</li></ul></p>`,
                    现有: `<p><span class="highlight-text">启动前预备 (Pre-Bracing):</span> 在移动任何肢体之前, 先做一次完整的呼气, 感受腹部向内收紧, 然后保持这个 "<span class="highlight-text">腹部护甲</span>>", 再开始缓慢地移动.</p><p><span class="highlight-text">意念引导升级:</span> 想象您的头顶, 伸出的手和伸出的脚后跟上各有一个激光笔. 您的目标是在整个动作中, 让这三个激光点在墙上画出<span class="highlight-text">三条尽可能远, 尽可能平稳的直线</span>.</p><p><strong>您的个性化工具箱 (退阶层级):</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">第一级 (最低难度):</span> 只在地面上向后滑动一条腿, 脚尖不离地.</li><li><span class="highlight-text">第二级:</span> 只在地面上向前滑动一只手臂.</li><li><span class="highlight-text">第三级:</span> 将一条腿抬离地面几厘米, 保持.</li><li><span class="highlight-text">第四级:</span> 将一只手臂抬至与躯干平行, 保持.</li><li><span class="highlight-text">第五级:</span> 只有在前面四个等级都能在核心绝对稳定的情况下完成时, 再尝试进行标准的对侧手脚抬起.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">增加保持时间:</span> 在伸展到位的姿态上增加保持时间，例如保持5-10秒。</li><li><span class="highlight-text">负重鸟狗式:</span> 在伸出的手臂或腿上增加轻微负重（例如小沙袋），增加核心挑战。</li><li><span class="highlight-text">弹力带鸟狗式:</span> 将弹力带固定在远端，连接到手腕或脚踝，在伸展时增加阻力。</li></ul></p>`
                }
            },
            'hip-flexor-stretch': { 
                module: 5, 
                title: '跪姿髋屈肌拉伸', 
                target: '拉伸因久坐而紧张的<span class="highlight-text">髋屈肌 (髂腰肌, 股直肌)</span>.', 
                principle: '<p>通过<span class="highlight-text">主动后倾骨盆并收紧臀肌</span>, 可以更精准, 更安全地拉伸到目标肌肉, 而不是通过腰椎过度伸展来代偿.</p>', 
                benefit: '<p><span class="highlight-text">缓解下背部紧张</span>, 改善骨盆前倾姿态, 为正确的伸髋模式 (如走路, 跑步, 深蹲) 打好基础.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>取一个高跪姿, 一腿在前, 一腿在后, 后侧膝盖着地 (可在下方垫软垫).</li><li><span class="highlight-text">核心步骤:</span> 收紧后侧腿的臀部和腹部, 感觉骨盆在做一个轻微的后倾 (仿佛尾巴要向前卷).</li><li>在保持这个后倾姿势的前提下, 身体作为一个整体缓慢前移, 直到感觉到后侧大腿前侧有<span class="highlight-text">清晰的牵拉感</span>.</li></li><li>保持30-45秒, 进行深长的呼吸.</li></ol>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">髋部有挤压感?</span> 这是关节撞击的信号。解决方法: 在向前推髋之前，先<span class="highlight-text">尽全力收紧后侧腿的臀部肌肉</span>，再温和地前移。这个 "臀肌发力" 的动作会把股骨头在髋臼里向后轻微拉动，为关节前侧创造空间。如果仍然疼痛，可略微减小前移幅度。</li></ul></p>`,
                    现有: `<p>参考 "<span class="highlight-text">7分感</span>>" 黄金法则与<span class="highlight-text">呼吸技巧</span>.</p><ul class="list-none list-outside mt-2"><li><span class="highlight-text">保护膝盖:</span> 在整个过程中, 保持被拉伸侧的脚 (放在大腿上的那只脚) 的脚踝处于轻微 "<span class="highlight-text">勾脚</span>>" 的状态, 这有助于稳定膝关节.</li><li><span class="highlight-text">感觉不深?</span> 可以尝试将支撑脚踩在墙上或椅子上, 通过调整身体与墙的距离来精确控制拉伸的强度.</li><li><span class="highlight-text">抱大腿困难?</span> 可以用毛巾或拉力带套在下方大腿后侧, 用手拉住毛巾两端辅助.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">手臂高举拉伸:</span> 在髋屈肌拉伸的同时，将同侧手臂高举过头，进一步增加对深层筋膜链的拉伸。</li><li><span class="highlight-text">增加时长:</span> 每次拉伸保持更长时间，例如60秒或更久。</li><li><span class="highlight-text">动态拉伸:</span> 在拉伸姿态下，进行小幅度的前后摇摆或旋转躯干，探索不同角度的肌纤维。</li></ul></p>`
                }
            },
            'figure-four-stretch': { 
                module: 5, 
                title: '仰卧4字拉伸', 
                target: '拉伸臀部<span class="highlight-text">深层外旋肌群 (如梨状肌)</span>, 缓解髋部后方紧张和潜在的坐骨神经刺激.', 
                principle: '<p>通过仰卧姿势<span class="highlight-text">固定脊柱</span>, 可以确保拉伸的力量<span class="highlight-text">精准地作用于髋关节</span>, 避免了站姿拉伸中可能出现的腰椎代偿.</p>', 
                benefit: '<p>改善<span class="highlight-text">髋关节外旋灵活性</span>, 降低因臀部肌肉紧张导致的下背痛或腿麻风险.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>仰卧, 双腿屈膝, 双脚平放于地.</li><li>将一侧的脚踝交叉放到另一侧的大腿上, 靠近膝盖的位置, 形成一个 "<span class="highlight-text">4</span>>" 字形.</li><li>将双手穿过腿部的空隙, 抱住下方大腿的后侧.</li><li>缓慢地将下方大腿拉向胸口, 直到感觉交叉腿的臀部有<span class="highlight-text">清晰的牵拉感</span>.</li><li>保持30-45秒, 进行深长的呼吸.</li></li><li>保持30-45秒, 进行深长的呼吸.</li></ol>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">借助毛巾/拉力带:</span> 如果抱不到大腿，可以用毛巾或拉力带套在下方大腿后侧，用手拉住毛巾两端辅助，逐渐靠近。</li><li><span class="highlight-text">靠墙辅助:</span> 躺在地上，将支撑脚踩在墙上，通过调整身体与墙的距离来精确控制拉伸强度，而无需用手抱腿。</li></ul></p>`,
                    现有: `<p>参考 "<span class="highlight-text">7分感</span>>" 黄金法则与<span class="highlight-text">呼吸技巧</span>.</p><ul class="list-none list-outside mt-2"><li><span class="highlight-text">保护膝盖:</span> 在整个过程中, 保持被拉伸侧的脚 (放在大腿上的那只脚) 的脚踝处于轻微 "<span class="highlight-text">勾脚</span>>" 的状态, 这有助于稳定膝关节.</li><li><span class="highlight-text">感觉不深?</span> 可以尝试将支撑脚踩在墙上或椅子上, 通过调整身体与墙的距离来精确控制拉伸的强度.</li></li><li><span class="highlight-text">抱大腿困难?</span> 可以用毛巾或拉力带套在下方大腿后侧, 用手拉住毛巾两端辅助.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">增加拉伸深度:</span> 在舒适范围内，将下方大腿拉向胸口更深，同时确保骨盆不离开地面。</li><li><span class="highlight-text">坐姿4字拉伸:</span> 尝试坐姿进行4字拉伸，这会对髋关节施加更大的压力，需要更好的柔韧性。</li><li><span class="highlight-text">动态伸展:</span> 在保持拉伸姿态的同时，小幅度地左右摇摆或旋转躯干，探索不同角度的肌纤维。</li></ul></p>`
                }
            },
            'doorway-stretch': { 
                module: 5, 
                title: '门框胸肌拉伸', 
                target: '针对性地拉伸因长期伏案或圆肩姿态而紧张的<span class="highlight-text">胸大肌和胸小肌</span>.', 
                principle: '<p>利用门框提供<span class="highlight-text">稳定的支撑点</span>, 允许身体前倾来安全, 有效地拉长胸部肌纤维.</p>', 
                benefit: '<p>改善<span class="highlight-text">圆肩驼背姿态</span>, 打开胸腔, 缓解肩颈紧张, 提升呼吸效率.</p>', 
                guide: `<ol class="list-decimal list-inside text-gray-300"><li>站在一个门框前.</li><li><span class="highlight-text">选择手臂高度以针对不同肌纤维:</span><ul class="list-disc list-inside ml-4 my-2"><li><span class="highlight-text">中胸 (通用):</span> 将手臂弯曲呈90度 (像投降的姿势), 前臂和小臂贴在门框上, 手肘与肩膀大致同高.</li><li><span class="highlight-text">下胸:</span> 将手臂抬得更高一点, 约120度.</li><li><span class="highlight-text">上胸/肩前束:</span> 将手臂放得更低一点, 约45度.</li></ul></li><li>同侧的脚向前迈出一小步, 身体作为一个整体缓慢前倾, 避免腰部前凸.</li></li><li>直到感觉胸部和肩膀前侧有<span class="highlight-text">清晰的牵拉感</span>.</li><li>保持30-45秒, 进行深长的呼吸.</li></ol>`, 
                solution: {
                    退阶: `<p><strong>退阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">肩部前方有尖锐疼痛?</span> 立即停止，这可能是撞击信号。首先尝试调整手臂的高度，通常放低手臂会更安全。如果任何角度都痛，则放弃此动作。</li><li><span class="highlight-text">减小前倾幅度:</span> 只需轻微前倾，直到感觉到一点点拉伸即可，不要强求深度。</li></ul></p>`,
                    现有: `<p>参考 "<span class="highlight-text">7分感</span>>" 黄金法则与<span class="highlight-text">呼吸技巧</span>.</p><ul class="list-none list-outside mt-2"><li><span class="highlight-text">避免耸肩:</span> 在整个动作中, 有意识地让肩膀下沉, 远离耳朵.</li><li><span class="highlight-text">肩部前方有尖锐疼痛?</span> 立即停止, 这可能是撞击信号. 首先尝试调整手臂的高度, 通常放低手臂会更安全. 如果任何角度都痛, 则放弃此动作.</li><li><span class="highlight-text">感受全身:</span> 这不是一个孤立的胸部拉伸, 尝试在拉伸时也保持核心的轻微收紧, 避免身体过度扭转.</li></ul></p>`,
                    进阶: `<p><strong>进阶解决方案:</strong> <ul class="list-none list-outside mt-1"><li><span class="highlight-text">增加前倾深度:</span> 在无痛范围内，身体向前倾斜更深，增加拉伸强度。</li><li><span class="highlight-text">结合旋转:</span> 在拉伸姿态下，尝试略微向远离门框的方向旋转躯干，可以更深入地拉伸胸肌。</li><li><span class="highlight-text">增加保持时间:</span> 每次拉伸保持更长时间，例如60秒或更久。</li></li></ul></p>`
                }
            }
        };

        const schedule = [
            { id: 'foam-roll', name: '泡沫轴松解 (股四头肌 & TFL)', quant: '1-2分钟/侧' },
            { id: 'breathing', name: '90/90呼吸', quant: '5组x5次呼吸' },
            { id: 'tripod-foot', name: '足部三点支撑抓地', quant: '3组x5-10秒' },
            { id: 'ankle-stability', name: '单脚稳定训练', quant: '15-30秒/侧' },
            { id: 'wall-sit', name: '靠墙静蹲', quant: '3组x30-60秒' },
            { id: 'glute-bridge', name: '臀桥', quant: '3组x15次' },
            { id: 'clamshell', name: '蚌式开合', quant: '3组x15次/侧' },
            { id: 'scapular-pushup', name: '四点支撑肩胛推移', quant: '3组x12次' },
            { id: 'bird-dog', name: '鸟狗式', quant: '3组x8次/侧' },
            { id: 'hip-flexor-stretch', name: '跪姿髋屈肌拉伸', quant: '2组x30-45秒/侧' },
            { id: 'figure-four-stretch', name: '仰卧4字拉伸', quant: '2组x30-45秒/侧' },
            { id: 'doorway-stretch', name: '门框胸肌拉伸', quant: '2组x30-45秒/侧' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // --- Element Selectors ---
            const tabsContainer = document.getElementById('tabs-container');
            const tabContentContainer = document.getElementById('tab-content-container');
            const taskList = document.getElementById('task-list');
            const journalInput = document.getElementById('journal-input');
            const saveJournalEntryButton = document.getElementById('save-journal-entry');
            const exportJournalEntryButton = document.getElementById('export-journal-entry'); // New export button
            const journalEntriesContainer = document.getElementById('journal-entries');
            const backgroundContainer = document.querySelector('.background-container');
            const musicToggle = document.getElementById('music-toggle');
            const backgroundMusic = document.getElementById('background-music');

            
            // Modal selectors
            const modalOverlay = document.getElementById('modal-overlay');
            const mainModalContainer = document.getElementById('modal-container');
            const mainModalContent = document.getElementById('modal-content');
            const mainModalCloseButton = document.getElementById('modal-close-button');
            const journalEditModal = document.getElementById('journal-edit-modal');
            const journalEditInput = document.getElementById('journal-edit-input');
            const journalEditSaveButton = document.getElementById('journal-edit-save');
            const journalEditCancelButton = document.getElementById('journal-edit-cancel');
            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const deleteConfirmButton = document.getElementById('delete-confirm-button');
            const deleteConfirmCancelButton = document.getElementById('delete-confirm-cancel');

            // --- State and Storage ---
            let tasksState = {};
            const journalStorageKey = 'rehab_journal_entries';
            let entryToModifyTimestamp = null;
            let currentExerciseSolutionData = null; // To store the current exercise's solution data
            
             // --- Image Orb Cycling ---
            const imageUrls = [
                'https://i.pinimg.com/originals/1f/4a/03/1f4a032c61aba66fff3daaf26dceba6b.gif',
                'https://i.pinimg.com/736x/3f/03/e4/3f03e4cfffd1c809b95b768c9ade2026.jpg',
                'https://i.imgur.com/IsyXuM0.png',
                'https://i.pinimg.com/736x/cd/af/20/cdaf20803fb4575ba6b7181f1ea53e15.jpg',
                'https://i.pinimg.com/originals/49/ac/ab/49acabdb9efbcf9fd7f3ba9a6a7a4cdd.gif',
                'https://i.postimg.cc/503F2FzC/b351e8ae8815ba03549d49ec659a17b.jpg',
                'https://i.pinimg.com/originals/97/b0/6e/97b06e3b1dc8fa4a40066fbc57e24d82.gif',
                'https://i.pinimg.com/736x/95/18/55/951855597e5f63620a42572adf82026c.jpg'
            ];
            let currentImageIndex = 0;
            let activeOrbIndex = 0;
            const imageOrbContainer = document.getElementById('image-orb-container');
            const activeOrbs = [];
            
            // Preloads images to ensure smooth transitions
            function smartImageLoader(urlsToLoad, callback) {
                let loadedCount = 0;
                if (urlsToLoad.length === 0) {
                    callback();
                    return;
                }
                urlsToLoad.forEach(url => {
                    const img = new Image();
                    img.src = url;
                    img.onload = img.onerror = () => {
                        loadedCount++;
                        if (loadedCount === urlsToLoad.length) {
                            callback();
                        }
                    };
                });
            }

            // Initializes image orbs for background
            function initImageOrbs() {
                for(let i=1; i<=3; i++) {
                    const orb = document.createElement('div');
                    orb.className = `image-orb orb-${i}`;
                    
                    const bg1 = document.createElement('div');
                    bg1.className = 'orb-bg';
                    
                    const bg2 = document.createElement('div');
                    bg2.className = 'orb-bg is-fading';

                    orb.appendChild(bg1);
                    orb.appendChild(bg2);
                    imageOrbContainer.appendChild(orb);
                    activeOrbs.push(orb);

                    bg1.style.backgroundImage = `url('${imageUrls[currentImageIndex]}')`;
                    currentImageIndex = (currentImageIndex + 1) % imageUrls.length;
                }
            }
            
            // Updates the image of a given orb
            function updateOrbImage(orb) {
                const newImageUrl = imageUrls[currentImageIndex];
                currentImageIndex = (currentImageIndex + 1) % imageUrls.length;
                
                // Preload the next image before transition
                const img = new Image();
                img.src = newImageUrl;
                img.onload = () => {
                    const fadingOutBg = orb.querySelector('.orb-bg:not(.is-fading)');
                    const fadingInBg = orb.querySelector('.orb-bg.is-fading');
                    
                    fadingInBg.style.backgroundImage = `url('${newImageUrl}')`;
                    
                    fadingOutBg.classList.add('is-fading');
                    fadingInBg.classList.remove('is-fading');
                };
            }

            // Cycles through the image orbs, updating one at a time
            function cycleImages() {
                const orbToUpdate = activeOrbs[activeOrbIndex];
                updateOrbImage(orbToUpdate);
                activeOrbIndex = (activeOrbIndex + 1) % activeOrbs.length;
            }

            // --- Task List Functions ---
            // Gets the storage key for tasks based on the current date
            function getTaskStorageKey() {
                const today = new Date().toISOString().split('T')[0];
                return `rehab_tasks_${today}`;
            }

            // Loads tasks from local storage
            function loadTasks() {
                const savedTasks = localStorage.getItem(getTaskStorageKey());
                tasksState = savedTasks ? JSON.parse(savedTasks) : {};
                renderTaskList();
            }
            
            // Saves tasks to local storage
            function saveTasks() {
                localStorage.setItem(getTaskStorageKey(), JSON.stringify(tasksState));
            }

            // Renders the task list in the UI
            function renderTaskList() {
                taskList.innerHTML = '';
                schedule.forEach(task => {
                    const isChecked = tasksState[task.id] || false;
                    // Task items are no longer clickable to open a modal
                    const taskHTML = `
                        <div class="task-item">
                            <input type="checkbox" id="task-${task.id}" class="task-checkbox hidden" ${isChecked ? 'checked' : ''}>
                            <div class="task-container flex items-center w-full p-4 rounded-xl transition-all duration-400">
                                <label for="task-${task.id}" class="task-circle-label flex-shrink-0">
                                    <div class="task-circle w-6 h-6 border-2 rounded-full mr-4 flex items-center justify-center flex-shrink-0 cursor-pointer"></div>
                                </label>
                                <span class="task-text flex-grow relative z-10 cursor-default">${task.name}</span>
                                <span class="font-mono text-sm text-cyan-200 bg-cyan-500/20 px-3 py-1 rounded-full ml-auto whitespace-nowrap relative z-10">${task.quant}</span>
                            </div>
                        </div>`;
                    taskList.insertAdjacentHTML('beforeend', taskHTML);
                });

                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        tasksState[checkbox.id.replace('task-', '')] = checkbox.checked;
                        saveTasks();
                    });
                });
            }
            
            // --- Journal Functions ---
            // Retrieves journal entries from local storage
            function getJournalEntries() { return JSON.parse(localStorage.getItem(journalStorageKey) || '[]'); }
            // Saves journal entries to local storage
            function saveJournalEntries(entries) { localStorage.setItem(journalStorageKey, JSON.stringify(entries)); }

            // Renders journal entries in the UI
            function renderJournalEntries() {
                journalEntriesContainer.innerHTML = '';
                const entries = getJournalEntries();
                entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                entries.forEach(entry => {
                    const entryDate = new Date(entry.date);
                    const formattedDate = `${entryDate.getFullYear()}年${entryDate.getMonth() + 1}月${entryDate.getDate()}日 ${entryDate.toLocaleTimeString('zh-CN', { hour: '2-digit', minute:'2-digit' })}`;
                    const entryHTML = `
                        <div class="bg-black/20 p-4 rounded-lg border border-white/10" data-timestamp="${entry.date}">
                            <p class="text-sm font-semibold text-cyan-300 mb-2">${formattedDate}</p>
                            <p class="text-slate-300 whitespace-pre-wrap break-words mb-3">${entry.content}</p>
                            <div class="journal-actions flex gap-2 justify-end">
                                <button class="edit-journal-btn text-xs py-1 px-3 rounded-md">修改</button>
                                <button class="delete-journal-btn text-xs py-1 px-3 rounded-md">删除</button>
                            </div>
                        </div>`;
                    journalEntriesContainer.insertAdjacentHTML('beforeend', entryHTML);
                });
            }

            // Event listener for saving journal entries
            saveJournalEntryButton.addEventListener('click', () => {
                const content = journalInput.value.trim();
                if (content === '') return;
                const entries = getJournalEntries();
                entries.push({ date: new Date().toISOString(), content: content });
                saveJournalEntries(entries);
                journalInput.value = '';
                renderJournalEntries();
            });

            // Event listener for exporting journal entries
            exportJournalEntryButton.addEventListener('click', () => {
                const entries = getJournalEntries();
                if (entries.length === 0) {
                    // Implement a custom message box instead of alert()
                    console.log("没有日志可导出。");
                    return;
                }

                let exportContent = "训练日志 - THE MANUAL\n\n";
                entries.forEach(entry => {
                    const entryDate = new Date(entry.date);
                    const formattedDate = `${entryDate.getFullYear()}年${entryDate.getMonth() + 1}月${entryDate.getDate()}日 ${entryDate.toLocaleTimeString('zh-CN', { hour: '2-digit', minute:'2-digit' })}`;
                    exportContent += `日期: ${formattedDate}\n`;
                    exportContent += `内容:\n${entry.content}\n`;
                    exportContent += `--------------------\n\n`;
                });

                const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = '训练日志.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
            });
            
            // Event listener for editing and deleting journal entries
            journalEntriesContainer.addEventListener('click', e => {
                const entryElement = e.target.closest('[data-timestamp]');
                if (!entryElement) return;
                entryToModifyTimestamp = entryElement.dataset.timestamp;

                if (e.target.matches('.edit-journal-btn')) {
                    const entries = getJournalEntries();
                    const entryToEdit = entries.find(entry => entry.date === entryToModifyTimestamp);
                    if (entryToEdit) {
                        journalEditInput.value = entryToEdit.content;
                        showModal(journalEditModal);
                    }
                } else if (e.target.matches('.delete-journal-btn')) {
                    showModal(deleteConfirmModal);
                }
            });

            // Event listeners for journal edit modal
            journalEditSaveButton.addEventListener('click', () => {
                let entries = getJournalEntries();
                const entryIndex = entries.findIndex(entry => entry.date === entryToModifyTimestamp);
                if (entryIndex > -1) {
                    entries[entryIndex].content = journalEditInput.value.trim();
                    saveJournalEntries(entries);
                    renderJournalEntries();
                    hideAllModals();
                }
            });
            journalEditCancelButton.addEventListener('click', hideAllModals);

            // Event listeners for delete confirmation modal
            deleteConfirmButton.addEventListener('click', () => {
                let entries = getJournalEntries();
                const updatedEntries = entries.filter(entry => entry.date !== entryToModifyTimestamp);
                saveJournalEntries(updatedEntries);
                renderJournalEntries();
                hideAllModals();
            });
            deleteConfirmCancelButton.addEventListener('click', hideAllModals);

            // --- Module Content & Tabs ---
            // Renders module buttons based on exercise data
            function renderModuleContent() {
                for(let i=1; i<=5; i++){
                    const moduleContainer = document.getElementById(`tab-module${i}`);
                    moduleContainer.innerHTML = '';
                    const moduleExercises = Object.entries(exerciseData).filter(([_, data]) => data.module === i);
                    if(moduleExercises.length > 0) {
                         const exerciseList = document.createElement('div');
                         exerciseList.className = 'space-y-4';
                         moduleExercises.forEach(([id, data]) => {
                             exerciseList.innerHTML += `<button class="module-button open-modal-button w-full text-left p-5 rounded-xl shadow-sm flex justify-between items-center" data-id="${id}"><span class="relative z-10 font-semibold text-lg">${data.title}</span><svg xmlns="http://www.w3.org/2000/svg" class="relative z-10 h-6 w-6 text-cyan-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></button>`;
                         });
                         moduleContainer.appendChild(exerciseList);
                    }
                }
            }

            // Event listener for tab switching
            tabsContainer.addEventListener('click', (e) => {
                const button = e.target.closest('.tab');
                if (button) {
                    const tabId = button.dataset.tab;
                    tabsContainer.querySelectorAll('.tab').forEach(tab => tab.classList.replace('tab-active', 'tab-inactive'));
                    button.classList.replace('tab-inactive', 'tab-active');
                    tabContentContainer.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                    document.getElementById(`tab-${tabId}`).classList.remove('hidden');
                }
            });

            // --- Generic Modal Functions ---
            // Shows a given modal with transition effects
            function showModal(modalElement) {
                modalOverlay.style.display = 'flex';
                setTimeout(() => {
                    modalOverlay.classList.remove('opacity-0');
                    modalElement.classList.remove('hidden');
                    
                    if (modalElement.classList.contains('flex-col')) {
                        modalElement.style.display = 'flex';
                    } else {
                        modalElement.style.display = 'block';
                    }
                    
                    setTimeout(() => {
                       modalElement.classList.remove('opacity-0', 'scale-95');
                    }, 10);
                }, 10);
            }

            // Hides all modals with transition effects
            function hideAllModals() {
                 modalOverlay.classList.add('opacity-0');
                 mainModalContainer.classList.add('opacity-0', 'scale-95');
                 journalEditModal.classList.add('opacity-0', 'scale-95');
                 deleteConfirmModal.classList.add('opacity-0', 'scale-95');
                 setTimeout(() => {
                    modalOverlay.style.display = 'none';
                    mainModalContainer.classList.add('hidden');
                    journalEditModal.classList.add('hidden');
                    deleteConfirmModal.classList.add('hidden');

                    mainModalContainer.style.display = '';
                    journalEditModal.style.display = '';
                    deleteConfirmModal.style.display = '';
                 }, 300);
            }

            // Toggles collapsible content visibility with a smooth grid-based animation.
            function toggleCollapsibleContent(headerElement) {
                const contentElement = headerElement.nextElementSibling; // Get the content div
                if (contentElement && contentElement.classList.contains('collapsible-content')) {
                    // Just toggle the classes. CSS will handle the rest of the animation.
                    headerElement.classList.toggle('expanded');
                    contentElement.classList.toggle('expanded');
                }
            }


            // Opens the main exercise detail modal
            function openMainModal(id) {
                const data = exerciseData[id];
                if (!data) return;
                currentExerciseSolutionData = data.solution; // Store the solution's specific difficulty data
                mainModalContainer.style.display = 'block';

                // Map module number to Tailwind color classes and hex values
                const moduleAccentColors = {
                    1: { class: 'border-cyan-400', hex: '#22d3ee', rgb: '34, 211, 238' }, // cyan-400
                    2: { class: 'border-emerald-400', hex: '#34d399', rgb: '52, 211, 153' }, // emerald-400
                    3: { class: 'border-amber-400', hex: '#fbbf24', rgb: '251, 191, 36' }, // amber-400
                    4: { class: 'border-violet-400', hex: '#a78bfa', rgb: '167, 139, 250' }, // violet-400
                    5: { class: 'border-rose-400', hex: '#fb7185', rgb: '251, 113, 133' }  // rose-400
                };
                const accentColor = moduleAccentColors[data.module] || { class: 'border-slate-400', hex: '#94a3b8', rgb: '148, 163, 184' }; // Default slate-400

                // Function to render the solution content based on difficulty
                function renderSolutionContent(difficulty) {
                    const solutionContent = currentExerciseSolutionData[difficulty] || '';
                    const solutionTextDiv = document.getElementById('solution-text-content');
                    if (solutionTextDiv) {
                        solutionTextDiv.innerHTML = solutionContent;
                        // Apply dynamic highlight color to critical info after content is rendered
                        solutionTextDiv.querySelectorAll('.highlight-text').forEach(el => {
                            el.style.color = accentColor.hex; // Set color directly
                            el.style.fontWeight = '700'; // Ensure bold
                        });
                        // Ensure general prose styling is applied or maintained
                        solutionTextDiv.querySelectorAll('.prose li, .prose p, .prose strong, .prose ol, .prose ul').forEach(el => {
                            // Only set color if not a highlight-text, to avoid overriding the highlight
                            if (!el.classList.contains('highlight-text')) {
                                el.style.color = '#d1d5db'; // default slate-300
                            }
                            // Re-apply strong tag style if it's not a highlight
                            if (el.tagName === 'STRONG' && !el.classList.contains('highlight-text')) {
                                el.style.color = '#f0f0f0';
                                el.style.fontWeight = '700';
                            }
                        });
                    }
                }

                // Initial rendering of the modal content, with new wrappers for animation
                mainModalContent.innerHTML = `
                    <h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-cyan-400 mb-6">${data.title}</h2>
                    <div class="space-y-4 text-gray-300">
                        <!-- 训练目标 Section -->
                        <div class="collapsible-section">
                            <div class="collapsible-header" style="border-color: ${accentColor.hex};">
                                <h4 class="text-white">训练目标</h4>
                            </div>
                            <div class="collapsible-content" id="target-content">
                                <div class="inner-content-wrapper">
                                    <div class="content-box">
                                        <p>${data.target}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 动作原理与它如何帮助你 Section -->
                        ${data.principle || data.benefit ? `
                        <div class="collapsible-section">
                            <div class="collapsible-header" style="border-color: ${accentColor.hex};">
                                <h4 class="text-white">动作原理与它如何帮助你</h4>
                            </div>
                            <div class="collapsible-content" id="principle-content">
                                <div class="inner-content-wrapper">
                                    <div class="content-box">
                                        <div class="prose prose-sm max-w-none">
                                            ${data.principle ? data.principle : ''}
                                            ${data.benefit ? data.benefit : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>` : ''}

                        <!-- 事无巨细的执行指南 Section -->
                        ${data.guide ? `
                        <div class="collapsible-section">
                            <div class="collapsible-header" style="border-color: ${accentColor.hex};">
                                <h4 class="text-white">事无巨细的执行指南</h4>
                            </div>
                            <div class="collapsible-content" id="guide-content">
                                <div class="inner-content-wrapper">
                                    <div class="content-box">
                                        <div class="prose prose-sm max-w-none">${data.guide}</div>
                                    </div>
                                </div>
                            </div>
                        </div>` : ''}
                        
                        <!-- 精准纠错与个性化调整 Section (Error and Solution) -->
                        <div class="collapsible-section">
                            <div class="collapsible-header solution-header" style="border-color: ${accentColor.hex};">
                                <h4 class="text-white flex-grow">精准纠错与个性化调整</h4>
                                <div class="difficulty-buttons">
                                    <button class="difficulty-button" data-difficulty="退阶" title="退阶"></button>
                                    <button class="difficulty-button" data-difficulty="现有" title="现有"></button>
                                    <button class="difficulty-button" data-difficulty="进阶" title="进阶"></button>
                                </div>
                            </div>
                            <div class="collapsible-content" id="adjustment-content">
                                <div class="inner-content-wrapper">
                                    ${data.errorWhy ? `
                                    <div class="content-box">
                                        <h5 class="font-bold text-rose-300 mb-3 flex items-center gap-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>常见错误 & 原因
                                        </h5>
                                        <div class="text-gray-300/80 prose prose-sm max-w-none">${data.errorWhy}</div>
                                    </div>` : ''}
                                    <div class="content-box">
                                        <h5 class="font-bold text-emerald-300 mb-3 flex items-center gap-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>解决方案 & 调整
                                        </h5>
                                        <div id="solution-text-content" class="text-gray-300/90 prose prose-sm max-w-none space-y-2">
                                            <!-- Solution content will be rendered here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Set CSS variables for dynamic colors
                mainModalContent.style.setProperty('--module-accent-color', accentColor.hex);
                mainModalContent.style.setProperty('--button-glow-color', accentColor.hex);
                mainModalContent.style.setProperty('--button-glow-color-hover', accentColor.hex + 'B3'); /* Adding some transparency for hover */
                mainModalContent.style.setProperty('--highlight-color', accentColor.hex); /* Set highlight color dynamically */
                mainModalContent.style.setProperty('--highlight-color-rgb', accentColor.rgb); /* Set RGB for text-shadow */


                // Add event listeners for difficulty buttons
                const difficultyButtons = mainModalContent.querySelectorAll('.difficulty-button');
                difficultyButtons.forEach(button => {
                    // Set initial and hover colors using CSS variables or direct inline styles
                    button.style.setProperty('--difficulty-button-bg-color', `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.1)`);
                    button.style.setProperty('--difficulty-button-border-color', `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.3)`);
                    button.style.backgroundColor = `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.1)`;
                    button.style.borderColor = `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.3)`;

                    button.addEventListener('click', (event) => {
                        event.stopPropagation(); // Prevent header from collapsing when clicking difficulty buttons
                        const difficulty = button.dataset.difficulty;
                        difficultyButtons.forEach(btn => {
                            btn.classList.remove('selected');
                            btn.style.backgroundColor = `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.1)`;
                            btn.style.borderColor = `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.3)`;
                        });
                        button.classList.add('selected');
                        button.style.backgroundColor = `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.6)`; // A bit more opaque when selected
                        button.style.borderColor = `rgba(${parseInt(accentColor.rgb.split(',')[0])}, ${parseInt(accentColor.rgb.split(',')[1])}, ${parseInt(accentColor.rgb.split(',')[2])}, 0.8)`; // Stronger border when selected
                        renderSolutionContent(difficulty);
                    });
                });

                // Set '现有' as default selected difficulty and apply its styles
                const defaultSelectedButton = mainModalContent.querySelector('.difficulty-button[data-difficulty="现有"]');
                if (defaultSelectedButton) {
                    // Manually trigger click to ensure styles are applied
                    defaultSelectedButton.click(); 
                } else {
                    renderSolutionContent('现有'); // Fallback if default button not found
                }

                // Add event listeners for collapsible headers
                mainModalContent.querySelectorAll('.collapsible-header').forEach(header => {
                    // All headers now toggle on click to the header
                    header.addEventListener('click', () => {
                        toggleCollapsibleContent(header);
                    });
                });

                // Initial collapse all sections
                mainModalContent.querySelectorAll('.collapsible-section').forEach(section => {
                    const header = section.querySelector('.collapsible-header');
                    const content = section.querySelector('.collapsible-content');
                    if (header && content) {
                        content.classList.remove('expanded');
                        header.classList.remove('expanded');
                    }
                });

                showModal(mainModalContainer);
            }

            // --- Music Player Logic ---
            musicToggle.addEventListener('click', () => {
                if (backgroundMusic.currentSrc.includes('YOUR_AUDIO_LINK_HERE.mp3')) {
                    console.warn('音频源是占位符，请在HTML代码中替换为您自己的MP3音频链接。');
                    return; 
                }

                if (backgroundMusic.paused) {
                    backgroundMusic.play().catch(e => {
                        if (e.name === 'NotAllowedError') {
                            console.warn("Playback prevented by browser. User must interact with the document first.");
                        } else {
                            console.error("Audio play failed:", e)
                        }
                    });
                } else {
                    backgroundMusic.pause();
                }
            });

            backgroundMusic.onplay = () => {
                musicToggle.classList.add('playing');
            };
            backgroundMusic.onpause = () => {
                 musicToggle.classList.remove('playing');
            }


            // --- Global Event Listeners ---
            document.body.addEventListener('click', (e) => {
                if (e.target.closest('.open-modal-button')) {
                    openMainModal(e.target.closest('.open-modal-button').dataset.id)
                };
            });
            mainModalCloseButton.addEventListener('click', hideAllModals);
            modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) hideAllModals(); });

            // --- Initial Load ---
            initImageOrbs();
            smartImageLoader(imageUrls.slice(0, 3), () => {
                backgroundContainer.classList.remove('is-loading');
                setInterval(cycleImages, 10000); // Evolve one image every 10 seconds
            });

            loadTasks();
            renderModuleContent();
            renderJournalEntries();
        });
    </script>
</body>
</html>
